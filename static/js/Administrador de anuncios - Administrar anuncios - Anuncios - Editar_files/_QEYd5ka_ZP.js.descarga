if (self.CavalryLogger) { CavalryLogger.start_js_script(document.currentScript); }/*FB_PKG_DELIM*/

__d("AbstractRangeInput.react",["cx","invariant","Event","Keys","ReactDOM","UserAgent","joinClasses","react"],function(a,b,c,d,e,f,g,h,i){var j=d("react");a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.state={values:[].concat(c.props.values).sort(function(a,b){return a-b}),controlledValues:c.props.values,draggingIdx:null},c.$3=function(a){var b;((b=c.$2)==null?void 0:b.dragStartX)!=null&&c.$9(a.clientX-c.$2.dragStartX)},c.$4=function(a){c.$11()},c.$6=function(a,b){c.$11()},c.$5=function(a,b){((a=c.$2)==null?void 0:a.dragStartX)!=null&&b.touches&&c.$9(b.touches[0].clientX-c.$2.dragStartX)},b)||babelHelpers.assertThisInitialized(c)}b.getDerivedStateFromProps=function(a,b){if(b.controlledValues===a.values)return b;var c=[].concat(a.values);a.behavior!=="free"&&c.sort(function(a,b){return a-b});return babelHelpers["extends"]({},b,{values:c,controlledValues:a.values})};var e=b.prototype;e.componentDidMount=function(){var a=this,b=c("UserAgent").isBrowser("IE < 9")?document.documentElement:window;this.$1=c("Event").listen(b,{selectstart:function(b){a.$2&&c("Event").prevent(b)},mousemove:this.$3,mouseup:this.$4,touchmove:this.$5,touchend:this.$6})};e.componentWillUnmount=function(){for(var a in this.$1)this.$1[a]&&this.$1[a].remove(),this.$1[a]=null};e.$7=function(a,b){switch(c("Event").getKeyCode(b)){case c("Keys").DOWN:case c("Keys").LEFT:this.$8(a);this.$9(-1);break;case c("Keys").RIGHT:case c("Keys").UP:this.$8(a);this.$9(1);break}};e.$10=function(a,b){c("Event").prevent(b),this.$8(a).dragStartX=b.nativeEvent.clientX};e.$8=function(a){var b=d("ReactDOM").findDOMNode(this);b instanceof Element||i(0,45360);this.setState(function(b){return babelHelpers["extends"]({},b,{draggingIdx:a})});return this.$2={draggingIdx:a,dragStartValue:this.state.values[a],scale:b.clientWidth}};e.$9=function(a){var b=this;this.$2!=null||i(0,45361);var c=(this.props.max-this.props.min)/this.$2.scale,d=this.$2.dragStartValue+a*c,e=this.$2.draggingIdx;if(this.props.step){a=1/this.props.step;d=Math.round(d*a)/a}this.setState(function(a){var c=[].concat(a.values),f=c.length,g=b.props.min,h=b.props.max;b.props.behavior==="block"&&(g=e>0?c[e-1]:g,h=e<f-1?c[e+1]:h);d=d<g?g:d;d=d>h?h:d;c[e]=d;b.props.behavior==="push"&&c.sort(function(a,b){return a-b});b.props.onChange&&b.props.onChange(c);return babelHelpers["extends"]({},a,{values:c})})};e.$11=function(){this.setState(function(a){return babelHelpers["extends"]({},a,{draggingIdx:null})}),this.$2=null};e.$12=function(a,b){c("Event").prevent(b),this.$8(a).dragStartX=b.nativeEvent.touches[0].clientX};e.render=function(){var a=this,b=this.state.values,d=this.props.disabled,e=b.length>1,f=this.props.max-this.props.min;b=b.map(function(b,g){var h=(b-a.props.min)/f,i=a.props.name+(e?"["+g+"]":"");return j.jsx("div",{className:"_4qwr"+(d?" _4qws":"")+(a.state.draggingIdx===g?" _9vep":""),onDragStart:c("Event").prevent,onKeyDown:d?null:function(b){return a.$7(g,b)},onMouseDown:d?null:function(b){return a.$10(g,b)},onTouchEnd:d?null:function(b){return a.$6(g,b)},onTouchMove:d?null:function(b){return a.$5(g,b)},onTouchStart:d?null:function(b){return a.$12(g,b)},style:{left:h*100+"%"},role:"slider","aria-valuemin":a.props.min,"aria-valuemax":a.props.max,"aria-valuenow":b,tabIndex:0,children:j.jsx("input",{onChange:a.props.onChange,name:i,value:b,type:"hidden"})},"thumb-"+g)});return j.jsxs("div",babelHelpers["extends"]({},this.props,{className:c("joinClasses")(this.props.className,"_4qwt"),children:[j.jsx("div",{className:"_4qwu"}),b]}))};return b}(j.Component);a.defaultProps={name:"",min:0,max:1,step:.01,disabled:!1,values:[.5],behavior:"free"};g["default"]=a},98);
__d("RangeInput.react",["cx","AbstractRangeInput.react","joinClasses","react"],function(a,b,c,d,e,f,g,h){var i=d("react");a=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}var d=b.prototype;d.render=function(){return i.jsx(c("AbstractRangeInput.react"),babelHelpers["extends"]({},this.props,{className:c("joinClasses")(this.props.className,"_5rvw")}))};return b}(i.Component);g["default"]=a},98);
__d("UFIStickerButton.react",["cx","fbt","Arbiter","Bootloader","FocusRelocator.react","Link.react","StickerInterfaces","createReactClass_DEPRECATED","getObjectValues","prop-types","react","setImmediate"],function(a,b,c,d,e,f,g,h,i){"use strict";var j=d("react");a=c("createReactClass_DEPRECATED")({displayName:"UFIStickerButton",_clickGuard:!1,_updateListener:null,_openFlyoutListener:null,_linkRef:null,propTypes:{customStickerOwnerID:c("prop-types").string,onStickerFlyoutShow:c("prop-types").func,onStickerSelected:c("prop-types").func.isRequired,showTooltip:c("prop-types").bool,stickerInterface:c("prop-types").oneOf(c("getObjectValues")(c("StickerInterfaces"))),tabIndex:c("prop-types").number},getDefaultProps:function(){return{customStickerOwnerID:"",showTooltip:!0,stickerInterface:"comments"}},getInitialState:function(){return{renderFlyout:null,flyoutShown:!1}},componentDidMount:function(){var a=this;this._updateListener=c("Arbiter").subscribe("page_transition",function(){return a._hideFlyout()});this._openFlyoutListener=c("Arbiter").subscribe("GamingStickers/openFlyout",function(b,c){return a._showFlyout(c)})},componentWillUnmount:function(){this._updateListener&&this._updateListener.unsubscribe(),this._openFlyoutListener&&this._openFlyoutListener.unsubscribe()},render:function(){var a=i._("Publicar sticker");return j.jsx(c("FocusRelocator.react"),{from:this._linkRef,to:this.refs.icon,children:j.jsxs(c("Link.react"),{"aria-label":a,className:"_r1a UFICommentStickerButton","data-hover":"tooltip","data-tooltip-alignh":"center","data-tooltip-content":this.props.showTooltip?a:null,linkRef:this._setRef,onClick:this._onLinkClicked,onMouseDown:this._prepareForClick,role:"button",tabIndex:this.props.tabIndex,children:[j.jsx("div",{ref:"icon",className:"UFICommentStickerIcon"+(this.state.flyoutShown?" UFICommentStickerIconActive":"")}),this.props.children,this.state.renderFlyout?this.state.renderFlyout():null]})})},_hideFlyout:function(){this.setState({flyoutShown:!1})},_showFlyout:function(a){var b=this;c("Bootloader").loadModules(["ContextualLayerAutoFlip","LayerTabIsolation","StickersFlyout.react","XUIContextualDialog.react","StickersActions"],function(d,e,f,g,h){b.setState({flyoutShown:!0,renderFlyout:function(){return j.jsx(g,{alignment:"right",behaviors:{ContextualLayerAutoFlip:d,LayerTabIsolation:e},className:"_5e-r",contextRef:function(){return b._linkRef},onBlur:b._hideFlyout,onToggle:function(a){!a&&b.state.flyoutShown&&b._hideFlyout()},position:"above",shown:b.state.flyoutShown,hasActionableContext:!0,width:278,children:j.jsx("div",{children:j.jsx(f,{customStickerOwnerID:b.props.customStickerOwnerID,onEscKeyDown:b._hideFlyout,onStickerSelect:b._onStickerSelected,stickerInterface:b.props.stickerInterface,shown:b.state.flyoutShown})})})}}),b.props.onStickerFlyoutShow&&b.props.onStickerFlyoutShow(),a&&c("setImmediate")(function(){return h.selectTrayPack(a)})},"UFIStickerButton.react")},_prepareForClick:function(){this._clickGuard=this.state.flyoutShown},_onLinkClicked:function(a){a.preventDefault();if(this.state.renderFlyout!==null){this._clickGuard||(this.props.onStickerFlyoutShow&&this.props.onStickerFlyoutShow(),this.setState({flyoutShown:!0}));return}this._showFlyout(null)},_onStickerSelected:function(a,b,c){this.props.onStickerSelected(a,b,c),this._hideFlyout()},_setRef:function(a){this._linkRef=a}});b=a;g["default"]=b},98);
__d("XUIRadioButtonGroup.react",["Focus","RTLKeys","ReactDOM","XUIButtonGroup.react","createReactClass_DEPRECATED","prop-types","react"],function(a,b,c,d,e,f){var g,h=g||b("react");a=b("createReactClass_DEPRECATED")({displayName:"XUIRadioButtonGroup",propTypes:{onValueChange:b("prop-types").func,selectedValue:b("prop-types").any,selectedUse:b("prop-types").oneOf(["default","special","confirm"]),selectedDepressed:b("prop-types").bool},UNSAFE_componentWillMount:function(){this.radioChildComponents=[]},render:function(){var a=this,c=this,d=h.Children.toArray(this.props.children).some(function(b){return a.props.selectedValue===b.props.value}),e=h.Children.map(this.props.children,function(b,e){var f=a.props.selectedValue===b.props.value,g=f&&"selectedDepressed"in a.props?a.props.selectedDepressed:b.props.depressed,i=f?"0":"-1";!f&&!d&&e===0&&(i="0");i={role:"radio","aria-checked":f?"true":"false",tabIndex:i,onKeyDown:c._onKeyDown};f=babelHelpers["extends"]({onClick:a._getClickHandler(b.props.value,b.props.onClick),use:f&&"selectedUse"in a.props?a.props.selectedUse:b.props.use,depressed:g,ref:function(b){a.radioChildComponents[e]=b}},i);return h.cloneElement(b,f)},this),f={role:"radiogroup"};return h.jsx(b("XUIButtonGroup.react"),babelHelpers["extends"]({},this.props,f,{children:e}))},_getClickHandler:function(a,b){var c=this.props;return function(){c.onValueChange&&c.onValueChange(a),b&&b.apply(this,arguments)}},_onKeyDown:function(a){var c=this;switch(Event.getKeyCode(a)){case b("RTLKeys").UP:case b("RTLKeys").getLeft():d(-1);break;case b("RTLKeys").DOWN:case b("RTLKeys").getRight():d(1);break;case b("RTLKeys").SPACE:d(0);break}function d(a){a=e(a);var d=h.Children.toArray(c.props.children)[a];c._getClickHandler(d.props.value,d.props.onClick)();d=b("ReactDOM").findDOMNode(c.radioChildComponents[a]);b("Focus").set(d)}function e(a){var b=c.props,d=h.Children.toArray(b.children),e=b.selectedValue;b=d.filter(function(a){return a.props.value===e})[0];b=d.indexOf(b);b=b===-1?0:b+a;b<0&&(b=0);b>d.length-1&&(b=d.length-1);return b}}});e.exports=a},null);
__d("PhotoEditorDragRegistrar",["Event","SubscriptionsHandler"],function(a,b,c,d,e,f){a=function(){"use strict";function a(a){this.root=a,this.$1=!1,this.$2=new(b("SubscriptionsHandler"))(),this.$2.addSubscriptions(b("Event").listen(this.root,"mousedown",this.$3.bind(this)),b("Event").listen(window,"mousemove",this.$4.bind(this)),b("Event").listen(window,"mouseup",this.$5.bind(this)))}var c=a.prototype;c.onMouseDown=function(a){};c.onMouseMove=function(a){};c.onMouseUp=function(a){};c.getElement=function(){return this.root};c.$3=function(a){if(!(a.which&&a.which===1||a.button&&a.button===1))return;this.$1=!0;this.onMouseDown(a);b("Event").kill(a)};c.$4=function(a){this.$1&&(this.onMouseMove(a),b("Event").kill(a))};c.$5=function(a){this.$1&&(this.onMouseMove(a),this.onMouseUp(a),this.$1=!1,b("Event").kill(a))};return a}();e.exports=a},null);
__d("CropWindow",["csx","cx","CSS","DOM","PhotoEditorDragRegistrar","Style","SubscriptionsHandler","Vector","clamp","emptyFunction"],function(a,b,c,d,e,f,g,h){var i=["borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth"],j={TOP:0,RIGHT:1,BOTTOM:2,LEFT:3},k=100,l=function(c){"use strict";babelHelpers.inheritsLoose(a,c);function a(a){var d=b("DOM").create("div",{className:"_1auz"});d=c.call(this,d)||this;d.$CropDragHandle1=b("emptyFunction");d.$CropDragHandle2=a;d.$CropDragHandle3();return d}var d=a.prototype;d.$CropDragHandle3=function(){var a=this;this.$CropDragHandle2.forEach(function(c){switch(c){case j.TOP:b("CSS").addClass(a.root,"_1au-");break;case j.RIGHT:b("CSS").addClass(a.root,"_1au_");break;case j.BOTTOM:b("CSS").addClass(a.root,"_1av0");break;case j.LEFT:b("CSS").addClass(a.root,"_1av1")}})};d.onMouseDown=function(){b("CSS").addClass(this.root,"_1av2")};d.onMouseMove=function(a){this.$CropDragHandle1(this.$CropDragHandle4(a))};d.onMouseUp=function(){b("CSS").removeClass(this.root,"_1av2")};d.setUpdateHandler=function(a){this.$CropDragHandle1=a;return this};d.getCenterCoordinates=function(){return b("Vector").getElementPosition(this.root,"viewport").add(b("Vector").getElementDimensions(this.root).div(2))};d.$CropDragHandle4=function(a){var b={},c=this.getCenterCoordinates();this.$CropDragHandle2.forEach(function(d){switch(d){case j.TOP:b[j.TOP]=a.clientY-c.y;break;case j.RIGHT:b[j.RIGHT]=c.x-a.clientX;break;case j.BOTTOM:b[j.BOTTOM]=c.y-a.clientY;break;case j.LEFT:b[j.LEFT]=a.clientX-c.x}});return b};return a}(b("PhotoEditorDragRegistrar")),m=function(c){"use strict";babelHelpers.inheritsLoose(a,c);function a(a){a=c.call(this,a)||this;a.$CropBorder1=b("emptyFunction");a.$CropBorder2=null;a.$CropBorder3=null;return a}var d=a.prototype;d.onMouseDown=function(a){this.$CropBorder2=b("Vector").getEventPosition(a).sub(this.$CropBorder4())};d.onMouseMove=function(a){a=b("Vector").getEventPosition(a).sub(this.$CropBorder4()).sub(this.$CropBorder2);this.$CropBorder1(a)};d.setUpdateHandler=function(a){this.$CropBorder1=a;return this};d.$CropBorder4=function(){return b("Vector").getElementPosition(this.root,"viewport")};return a}(b("PhotoEditorDragRegistrar")),n=function(){"use strict";function a(a,b,c){this.$1=a,this.$2=b,this.$3=c}var c=a.prototype;c.getDraggedDistance=function(){return this.$1};c.getActualDistance=function(){return b("clamp")(this.$1,this.$2,this.$3)};c.getMin=function(){return this.$2};c.getMax=function(){return this.$3};return a}();a=function(){"use strict";function a(c,d){var e=this;this.$13=function(a){a=new l(a);a.setUpdateHandler(e.$14.bind(e));e.$10.appendChild(a.getElement())};this.$1=new(b("SubscriptionsHandler"))();this.$2=c;this.$3=c.getAspectRatio();this.$4=c.getOriginalImage();this.$5=0;this.$6=0;this.$7=this.$4.height;this.$8=this.$4.width;this.$9=!1;this.root=d;this.$10=b("DOM").find(this.root,"._1av3");new m(this.$10).setUpdateHandler(this.$11.bind(this));this.$1.addSubscriptions(c.subscribe("resize",this.$12.bind(this)));a.DRAG_HANDLES.forEach(this.$13,this);b("CSS").removeClass(this.root,"hidden_elem");this.hide()}var c=a.prototype;c.$12=function(a,b){b.pos.setElementPosition(this.root),b.dims.setElementDimensions(this.root),this.$15()};c.$11=function(a){var c=this.$2.getNumRotations();a=a.div(this.$2.getResizeFactor());var d=a;c==1?d=new(b("Vector"))(a.y,-a.x):c==2?d=a.mul(-1):c==3&&(d=new(b("Vector"))(-a.y,a.x));this.$5=b("clamp")(this.$5+Math.round(d.x),0,this.$4.width-this.$8);this.$6=b("clamp")(this.$6+Math.round(d.y),0,this.$4.height-this.$7);this.$15()};c.$14=function(a){var b=this.$2.getNumRotations(),c=this.$2.getResizeFactor(),d={},e,f,g,h;for(var i in a){e=Math.round(a[i]/c);h=(i-b+4)%4;switch(h){case j.TOP:f=-this.$6;g=this.$7-k;break;case j.BOTTOM:f=this.$6+this.$7-this.$4.height;g=this.$7-k;break;case j.LEFT:f=-this.$5;g=this.$8-k;break;case j.RIGHT:f=this.$5+this.$8-this.$4.width,g=this.$8-k}d[h]=new n(e,f,g)}(this.$3||this.$9)&&this.$16(d);for(h in d){e=d[h].getActualDistance();switch(+h){case j.TOP:this.$6+=e;case j.BOTTOM:this.$7-=e;break;case j.LEFT:this.$5+=e;case j.RIGHT:this.$8-=e}}this.$15()};c.$16=function(a){var b=Object.keys(a);if(b.length==2){var c=b[0];b=b[1];var d=a[c],e=a[b];a[c]=a[b]=new n(Math.round(d.getDraggedDistance()+e.getDraggedDistance()/2),Math.max(d.getMin(),e.getMin()),Math.min(d.getMax(),e.getMax()))}return this};c.reset=function(){var a=this.$2.getImageDimensions(),b=a.x;a=a.y;this.setCropDimensions(this.$17(b,a));return this.$15()};c.$17=function(a,b){if(!this.$3)return{x:0,y:0,width:a,height:b};var c={};a/this.$3>b?(c.height=b,c.width=b*this.$3):(c.width=a,c.height=a/this.$3);c.x=(a-c.width)/2;c.y=(b-c.height)/2;if(this.$2.isInverted){a=c.width;c.width=c.height;c.height=a;a=c.y;c.y=c.x;c.x=a}return c};c.enableSquareCrop=function(){this.$9=!0;var a=Math.round((this.$7-this.$8)/2);this.$7>this.$8?(this.$7=this.$8,this.$6+=a):(this.$8=this.$7,this.$5-=a);return this.$15()};c.disableSquareCrop=function(){this.$9=!1;return this};c.show=function(){b("CSS").show(this.root);return this};c.hide=function(){b("CSS").hide(this.root);return this};c.setCropDimensions=function(a,b,c,d){if(a instanceof Object){var e=a;a=e.x;b=e.y;c=e.width;d=e.height}this.$5=a;this.$6=b;this.$8=c;this.$7=d;return this};c.setInitialCropDimensions=function(a,b,c,d){this.$2.isFirstEdit()?this.setCropDimensions(this.$17(c,d)):this.setCropDimensions(a,b,c,d);return this};c.getCropDimensions=function(){return{x:this.$5,y:this.$6,width:this.$8,height:this.$7}};c.getElement=function(){return this.root};c.$15=function(){var a=this,c=this.$2.getResizeFactor();b("Style").apply(this.root,this.$18(this.$6*c,(this.$4.width-this.$5-this.$8)*c,(this.$4.height-this.$6-this.$7)*c,this.$5*c));b("Style").apply(this.$10,{height:"99.99%"});window.setTimeout(function(){return b("Style").apply(a.$10,{height:"100%"})},0);return this};c.$18=function(a,b,c,d){var e=this.$2.getNumRotations(),f={};f[this.$19(j.TOP,e)]=Math.max(a,0)+"px";f[this.$19(j.RIGHT,e)]=Math.max(b,0)+"px";f[this.$19(j.BOTTOM,e)]=Math.max(c,0)+"px";f[this.$19(j.LEFT,e)]=Math.max(d,0)+"px";return f};c.$19=function(a,b){return i[(a+b)%4]};c.hasCrop=function(){return this.$8!=this.$4.width||this.$7!=this.$4.height};return a}();a.DRAG_HANDLES=[[j.TOP,j.RIGHT],[j.BOTTOM,j.RIGHT],[j.BOTTOM,j.LEFT],[j.TOP,j.LEFT]];e.exports=a},null);
__d("PhotoEditorFont",["PhotoEditorConfig","sprintf"],function(a,b,c,d,e,f){var g=b("PhotoEditorConfig").Constants,h=function(){"use strict";function a(a,b,c){this.$1=a||g.DEFAULT_FONT_FAMILY,this.$2=b||g.DEFAULT_FONT_SIZE,this.$3=c||g.DEFAULT_FONT_METRIC}var c=a.prototype;c.setFamily=function(a){this.$1=a};c.getFamily=function(){return this.$1};c.setSize=function(a){this.$2=a};c.getSize=function(){return this.$2};c.setMetric=function(a){this.$3=a};c.getMetric=function(){return this.$3};c.toString=function(){return b("sprintf")("%s%s %s",this.$2,this.$3,this.$1)};c.copy=function(){return new a(this.$1,this.$2,this.$3)};return a}();h.getDefault=function(){return new h()};e.exports=h},null);
__d("PhotoEditorDialogs",["fbt","DOM","Dialog","Form","PhotoEditorFont","ReactDOM","react"],function(a,b,c,d,e,f,g){var h,i=h||b("react");function j(a,c,d){d||(d=c,c={});var e=b("DOM").create("div"),f=i.jsxs("form",{action:"#",children:[g._("Font size"),i.jsx("br",{}),i.jsx("input",{name:"size",defaultValue:c.size})," px ",i.jsx("br",{}),g._("Font family"),i.jsx("br",{}),i.jsxs("select",{name:"family",children:[i.jsx("option",{value:"arial",children:"Arial"}),i.jsx("option",{value:"verdana",children:"Verdana"}),i.jsx("option",{value:"tahoma",children:"Tahoma"})]}),i.jsx("br",{}),g._("Text"),i.jsx("br",{}),i.jsx("input",{name:"text",defaultValue:c.text})]});f=b("ReactDOM").render(f,e);f=e.firstChild;new(b("Dialog"))().setTitle(g._("Configure text")).setBody(e).setButtons(b("Dialog").OK_AND_CANCEL).setHandler(function(){d(b("Form").serialize(f))}).setCausalElement(a).show()}function a(a){j(a.getRoot(),function(c){a.addTextGraphic(c.text,new(b("PhotoEditorFont"))(c.family,c.size,"px"))})}function c(a){var c=a.getFont().getSize();c={text:a.getText(),size:c[1],family:c[2]};j(a.getElement(),c,function(c){a.updateText(c.text,new(b("PhotoEditorFont"))(c.family,c.size,"px"))})}function d(a,c,d){new(b("Dialog"))().setBody(g._("Are you sure you want to do that?")).setTitle(c).setButtons(b("Dialog").OK_AND_CANCEL).setHandler(d).setCausalElement(a.getRoot()).show()}e.exports={addText:a,editText:c,confirmation:d}},null);
__d("PhotoEditorImageData",[],function(a,b,c,d,e,f){var g=function(a,b,c,d){"use strict";this.r=a,this.g=b,this.b=c,this.a=d};g.fromArray=function(a,b){return new g(a[b],a[b+1],a[b+2],a[b+3])};a=function(){"use strict";function a(a){this.image_data=a,this.width=a.width,this.height=a.height,this.array=a.data}var b=a.prototype;b.getData=function(){return this.image_data};b.getWidth=function(){return this.width};b.getHeight=function(){return this.height};b.getPixel=function(a,b){a=this.getIndex(a,b);return g.fromArray(this.array,a)};b.setPixel=function(a,b,c){a=this.getIndex(a,b);this.array[a]=c.r;this.array[a+1]=c.g;this.array[a+2]=c.b;this.array[a+3]=c.a};b.getIndex=function(a,b){return 4*(a+b*this.width)};b.forEach=function(a){for(var b=0;b<this.getWidth();b++)for(var c=0;c<this.getHeight();c++)this.setPixel(b,c,a(this.getPixel(b,c)))};return a}();a.Pixel=g;e.exports=a},null);
__d("PhotoEditorCanvas",["BlobFactory","DOM","PhotoEditorImageData","Vector","sprintf"],function(a,b,c,d,e,f){c=function(){"use strict";function c(a){this._editor=a,this._canvas=b("DOM").create("canvas"),this._ctx=this._canvas.getContext("2d"),this._drawHandler=null}var d=c.prototype;d.setImageContent=function(a){this._canvas.width=a.width;this._canvas.height=a.height;this._ctx.drawImage(a,0,0);return this};d.drawGraphic=function(){this._ctx.drawImage.apply(this._ctx,arguments);return this};d.isBlobSupported=function(){return!!this._canvas.toBlob};d.getElement=function(){return this._canvas};d.getDimensions=function(){return new(b("Vector"))(this._canvas.width,this._canvas.height,"document")};d.getWidth=function(){return this._canvas.width};d.getHeight=function(){return this._canvas.height};d.getContext=function(){return this._ctx};d.setWidth=function(a){this._canvas.width=a;return this};d.setHeight=function(a){this._canvas.height=a;return this};d.toBlob=function(a){if(this.isBlobSupported()){this._canvas.toBlob(a);return}this.getBlobFromDataURL(a)};d.getBlobFromDataURL=function(c){var d=this.toDataURL("image/png"),e=d.match(/^data:(.*?);base64,/),f=e[1];d=d.substr(e[0].length);e=a.atob(d);d=new ArrayBuffer(e.length);var g=new Uint8Array(d);for(var h=0;h<e.length;h++)g[h]=e.charCodeAt(h);g=b("BlobFactory").getBlob([d],{type:f});c(g)};d.toBlobURL=function(b){this.toBlob(function(c){b(a.URL.createObjectURL(c))})};d.toURL=function(a){if(this.isBlobSupported()){this.toBlobURL(a);return}a(this.toDataURL())};d.toDataURL=function(a){return this._canvas.toDataURL(a)};d.resizedCopy=function(a,b){var c=a.x/this.getWidth();a=a.y/this.getHeight();if(b=="s")if(c>a)return this.scaledCopy(a);else return this.scaledCopy(c);else if(b=="p")if(c<a)return this.scaledCopy(a);else return this.scaledCopy(c);else throw new Error("mode must be one of PhotoResizeModeConst")};d.scaledCopy=function(a){var b=this._canvas.width*a;a=this._canvas.height*a;return new c().setWidth(b).setHeight(a).drawGraphic(this._canvas,0,0,b,a)};d.copy=function(){return this.scaledCopy(1)};d.getPixelColor=function(a,c,d){a=new(b("PhotoEditorImageData"))(this.getImageData(a,c,1,1)).getPixel(0,0);d&&(a=d(a));return b("sprintf")("rgba(%s,%s,%s,%s)",a.r,a.g,a.b,a.a)};d.getImageData=function(a,b,c,d){return this._ctx.getImageData(a||0,b||0,c||this.getWidth(),d||this.getHeight())};d.putImageData=function(a,b,c){this._ctx.putImageData(a,b||0,c||0);return this};d.toDataURI=function(){return this._canvas.toDataURL("image/png")};d.toBase64=function(){var a="data:image/png;base64,",b=this.toDataURI();return b.slice(a.length)};d.applyFilter=function(a,b){this.putImageData(new a(this).run(b))};d.enableDrawing=function(a,b){if(!this._editor)return;this.disableDrawing();this._drawHandler=new a(this._editor,b).start();return this._drawHandler};d.setDrawingFillStyle=function(a){if(!this._drawHandler)return;this._drawHandler.setFillStyle(a)};d.setFillStyle=function(a){this._ctx.fillStyle=a};d.disableDrawing=function(){if(!this._drawHandler)return;this._drawHandler.stop();this._drawHandler=null};d.clear=function(){this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height);return this};d.crop=function(a,b,d,e){var f=new c().setWidth(d).setHeight(e);f.drawGraphic(this._canvas,Math.max(0,a),Math.max(0,b),d,e,0,0,d,e);this.setImageContent(f.getElement());return this};d.fillText=function(a,b,c,d,e,f){this._ctx.font=b;f&&(this._canvas.width=this._ctx.measureText(a).width,this._ctx.font=b);this._ctx.textBaseline="top";this._ctx.fillStyle=c;this._ctx.fillText(a,d,e);return this};d.fillCircle=function(a,b,c,d){this._ctx.fillStyle=d||"black",this._ctx.beginPath(),this._ctx.arc(a,b,c,0,Math.PI*2),this._ctx.closePath(),this._ctx.fill()};d.fillRect=function(a,b,c,d,e){this._ctx.fillStyle=e||"black";this._ctx.fillRect(a||0,b||0,c||this._canvas.width,d||this._canvas.height);return this};return c}();e.exports=c},null);
__d("PhotoEditorDrawingCursor",["cx","CSS","PhotoEditorCanvas","Vector"],function(a,b,c,d,e,f,g){a=function(){"use strict";function a(a,c){this.$1=a,this.$2=c,this.$3=new(b("PhotoEditorCanvas"))(),this.$4=new(b("Vector"))(0,0),b("CSS").addClass(this.$3.getElement(),"_5ewz")}var c=a.prototype;c.getElement=function(){return this.$3.getElement()};c.update=function(){var a=this.$1.getCurrentBrushSize();this.$3.clear();this.$3.setWidth(a).setHeight(a);this.$2.drawStroke(this.$3,a/2,a/2);this.$4=new(b("Vector"))(a,a);return this};c.getDimensions=function(){return this.$4};return a}();e.exports=a},null);
__d("PhotoEditorInterpolation",[],function(a,b,c,d,e,f){a=function(){"use strict";function a(a){this.$1=null,this.$2=null,this.$3=a}var b=a.prototype;b.setPoints=function(a,b){this.$1=a;this.$2=b;this.$4=(this.$2.y-this.$1.y)/(this.$2.x-this.$1.x);this.$5=this.$1.y-this.$4*this.$1.x;if(this.isHorizontal()&&this.$1.x>this.$2.x||!this.isHorizontal()&&this.$1.y>this.$2.y){a=this.$1;this.$1=this.$2;this.$2=a}return this};b.invert=function(a){var b=a.x;a.x=a.y;a.y=b};b.isHorizontal=function(){return this.$4<=1&&this.$4>-1};b.draw=function(){this.isHorizontal()?this.$6():this.$7()};b.$7=function(){var a,b;if(!isFinite(this.$4))for(b=this.$1.y;b<=this.$2.y;b++)this.$3.draw(this.$1.x,b);else for(b=this.$1.y;b<=this.$2.y;b++)a=Math.floor((b-this.$5)/this.$4),this.$3.draw(a,b)};b.$6=function(){var a,b;for(a=this.$1.x;a<=this.$2.x;a++)b=Math.floor(this.$4*a+this.$5),this.$3.draw(a,b)};return a}();e.exports={Linear:a}},null);
__d("PhotoEditorDrawingHandlers",["Event","PhotoEditorDrawingCursor","PhotoEditorInterpolation","SubscriptionsHandler","Vector"],function(a,b,c,d,e,f){a=function(){"use strict";function a(a,c,d){this._editor=a,this._canvas=a.getWorkingCanvas(),this.setFillStyle(c),this.setBrushSize(d),this.image_data=this._canvas.getImageData(),this.isMouseDown=!1,this.subscriptionsHandler=new(b("SubscriptionsHandler"))(),this._lastPosition=null,this._func=null}var c=a.prototype;c.onMouseDown=function(a){this.isMouseDown=!0,a.preventDefault(),this._func=new(b("PhotoEditorInterpolation").Linear)(this)};c.onMouseUp=function(){this._lastPosition=null,this.isMouseDown=!1};c.onMouseMove=function(a){if(!this.isMouseDown)return;a=b("Vector").getEventPosition(a).sub(b("Vector").getElementPosition(this._editor.getCanvasWrapper())).div(this._editor.getResizeFactor());this._lastPosition&&this._func.setPoints(this._lastPosition,a).draw();this._lastPosition=a};c.onMouseLeave=function(){this._lastPosition=null};c.setBrushSize=function(a){this._brushSize=a,this.getDrawingCursor().update()};c.setFillStyle=function(a){if(a instanceof Image)this._fillStyle=this._canvas.getContext().createPattern(a,"no-repeat");else if(Array.isArray(a)){this._fillStyle=this._canvas.getContext().createLinearGradient(0,0,this._canvas.getwidth(),this._canvas.getHeight());for(var b=0;b<a.length;b++)this._fillStyle.addColorStop(a[b].index,a[b].color)}else this._fillStyle=a;this.getDrawingCursor().update()};c.drawStroke=function(a,b,c){};c.draw=function(a,b){this.drawStroke(this._canvas,a,b)};c.getDrawingCursor=function(){this._cursor||(this._cursor=new(b("PhotoEditorDrawingCursor"))(this._editor,this));return this._cursor};c.getCursorElement=function(){return this.getDrawingCursor().getElement()};c.start=function(){var a,c=this.getDrawingCursor();c.update();this.subscriptionsHandler.engage();this.subscriptionsHandler.addSubscriptions((a=b("Event")).listen(this._canvas.getElement(),"mouseleave",this.onMouseLeave.bind(this)),a.listen(this._canvas.getElement(),"mousemove",this.onMouseMove.bind(this)),a.listen(this._canvas.getElement(),"mousedown",this.onMouseDown.bind(this)),a.listen(this._canvas.getElement(),"mouseup",this.onMouseUp.bind(this)),a.listen(c.getElement(),"mousemove",this.onMouseMove.bind(this)),a.listen(c.getElement(),"mousedown",this.onMouseDown.bind(this)),a.listen(c.getElement(),"mouseup",this.onMouseUp.bind(this)));return this};c.getCurrentBrushRect=function(a,b){var c=this._editor.getCurrentBrushSize();a-=Math.floor(c/2);b-=Math.floor(c/2);return{x:a,y:b,width:c,height:c}};c.stop=function(){this.subscriptionsHandler.release();return this};return a}();c=function(a){"use strict";babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}var c=b.prototype;c.drawStroke=function(a,b,c){b=this.getCurrentBrushRect(b,c);a.fillRect(b.x,b.y,b.width,b.height,this._fillStyle)};return b}(a);d=function(a){"use strict";babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}var c=b.prototype;c.drawStroke=function(a,b,c){var d=this._editor.getCurrentBrushSize();a.fillCircle(b,c,d/2,this._fillStyle)};return b}(a);e.exports={SquareBrush:c,CircularBrush:d}},null);
__d("PhotoEditorFilterNames",[],function(a,b,c,d,e,f){a=Object.freeze({AUTO_ENHANCE:"auto",VINTAGE:"vintage",SPRING:"spring",SUMMER:"summer",FALL:"fall",WINTER:"winter",GRAYSCALE:"grayscale"});f["default"]=a},66);
__d("PhotoEditorFilters",["fbt","ClientFilterWorkerResource","PhotoEditorFilterNames","WebWorker","emptyFunction"],function(a,b,c,d,e,f,g){c=function(){"use strict";function a(){}var b=a.prototype;b.run=function(a,b,c){};b.getName=function(){};return a}();d=function(a){"use strict";babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.run=function(a,c,d){c=c||b("emptyFunction");d=d||b("emptyFunction");if(b("WebWorker").isSupported())var e=new(b("WebWorker"))(b("ClientFilterWorkerResource")).setMessageHandler(function(b){a.putImageData(b.data),c(b),e.terminate()}).setErrorHandler(function(a){d(a),e.terminate()}).execute().postMessage({data:a.getImageData(),filter:this.getFilterName()});else d()};d.getFilterName=function(){};return c}(c);var h=function(c){"use strict";babelHelpers.inheritsLoose(a,c);function a(){return c.apply(this,arguments)||this}var d=a.prototype;d.getName=function(){return g._("Vintage")};d.getFilterName=function(){return b("PhotoEditorFilterNames").VINTAGE};d.getLabel=function(){return g._("Filtro retro")};return a}(d),i=function(c){"use strict";babelHelpers.inheritsLoose(a,c);function a(){return c.apply(this,arguments)||this}var d=a.prototype;d.getName=function(){return g._("Primavera")};d.getFilterName=function(){return b("PhotoEditorFilterNames").SPRING};d.getLabel=function(){return g._("Filtro de primavera")};return a}(d),j=function(c){"use strict";babelHelpers.inheritsLoose(a,c);function a(){return c.apply(this,arguments)||this}var d=a.prototype;d.getName=function(){return g._("Verano")};d.getFilterName=function(){return b("PhotoEditorFilterNames").SUMMER};d.getLabel=function(){return g._("Filtro de verano")};return a}(d),k=function(c){"use strict";babelHelpers.inheritsLoose(a,c);function a(){return c.apply(this,arguments)||this}var d=a.prototype;d.getName=function(){return g._("Oto\u00f1o")};d.getFilterName=function(){return b("PhotoEditorFilterNames").FALL};d.getLabel=function(){return g._("Filtro de oto\u00f1o")};return a}(d),l=function(c){"use strict";babelHelpers.inheritsLoose(a,c);function a(){return c.apply(this,arguments)||this}var d=a.prototype;d.getName=function(){return g._("Invierno")};d.getFilterName=function(){return b("PhotoEditorFilterNames").WINTER};d.getLabel=function(){return g._("Filtro de invierno")};return a}(d),m=function(c){"use strict";babelHelpers.inheritsLoose(a,c);function a(){return c.apply(this,arguments)||this}var d=a.prototype;d.getName=function(){return g._("Nieve")};d.getFilterName=function(){return b("PhotoEditorFilterNames").GRAYSCALE};d.getLabel=function(){return g._("Filtro de nieve")};return a}(d);function a(){return[h,i,j,k,l,m]}e.exports={FilterBase:c,getFilters:a}},null);
__d("PhotoEditorShareDialog",["DOM"],function(a,b,c,d,e,f){a=function(){"use strict";function a(a,b){this._editor=a,this._dialog=b,this._insertCanvasInput(),this._insertImagePreview()}var c=a.prototype;c._insertCanvasInput=function(){var a=b("DOM").find(this._dialog.getRoot(),"form");a.appendChild(b("DOM").create("input",{type:"hidden",name:"stage",value:this._editor.toBase64()}))};c._insertImagePreview=function(){var a=b("DOM").find(this._dialog.getRoot(),".UIShareStage_Image");a.appendChild(this._editor.getPreviewCanvas(200/this._editor.getWorkingCanvas().getWidth()).getElement())};return a}();e.exports=a},null);
__d("PhotoEditorButtonHandler",["cx","Arbiter","AsyncDialog","AsyncRequest","CSS","PhotoEditorConfig","PhotoEditorDialogs","PhotoEditorDrawingHandlers","PhotoEditorFilters","PhotoEditorShareDialog"],function(a,b,c,d,e,f,g){c=b("PhotoEditorConfig").Actions;var h=b("PhotoEditorConfig").Constants;d=function(){"use strict";function a(a){this.$1=a,this.$2=new(b("Arbiter"))()}var c=a.prototype;c.subscribe=function(a,b){Array.isArray(a)||(a=[a]);a=a.map(function(a){return a.toString()});return this.$2.subscribe(a,this.$3.bind(null,b))};c.$3=function(a,b,c){a.apply(this,c)};c.handleAction=function(a,b){return this.$2.inform(a.toString(),[this.$1,b])};c.subscribeToStandardActions=function(){this.subscribeToStandardActionsExcept()};c.subscribeToStandardActionsExcept=function(a){var b=i;b=babelHelpers["extends"]({},b);if(a)for(var c=0;c<a.length;c++)delete b[a[c]];for(var a in b)this.subscribe(a,b[a])};return a}();function a(a){return function(c,d){b("PhotoEditorDialogs").confirmation(c,d.getAttribute("aria-label"),a.bind(this,c))}}var i={};i[c.BW_FILTER]=function(a){a.getWorkingCanvas().applyFilter(b("PhotoEditorFilters").BlackAndWhiteFilter)};i[c.REVERT]=function(a){a.revert()};i[c.PAINT_BRUSH]=function(a){a.enableDrawing(b("PhotoEditorDrawingHandlers").CircularBrush,a.getCurrentFillStyle()),a.updateBrushConfigVisibility({color:!0,size:!0}),b("CSS").addClass(a.getWorkingCanvas().getElement(),"_55g1")};i[c.PENCIL]=function(a){a.enableDrawing(b("PhotoEditorDrawingHandlers").SquareBrush,a.getCurrentFillStyle()),a.updateBrushConfigVisiblity({color:!0,size:!0}),b("CSS").addClass(a.getWorkingCanvas().getElement(),"_55g1")};i[c.REVERT_BRUSH]=function(a){a.enableDrawing(b("PhotoEditorDrawingHandlers").CircularBrush,a.getOriginalImage()),a.updateBrushConfigVisiblity({color:!1,size:!0}),b("CSS").addClass(a.getWorkingCanvas().getElement(),"_55g1")};i[c.SAVE_AS_PROFILE]=a(function(a){a.saveAsProfPic()});i[c.SAVE_IN_ALBUM]=function(a){b("AsyncDialog").send(new(b("AsyncRequest"))().setURI(h.BROWSE_ALBUMS_SAVE).setData({save_on_click:1}))};i[c.ADD_TEXT]=function(a){b("PhotoEditorDialogs").addText(a)};i[c.IMPORT_IMAGE]=function(a){b("AsyncDialog").send(new(b("AsyncRequest"))().setURI(h.BROWSE_ALBUMS_IMPORT))};i[c.SHARE]=function(a){new(b("AsyncDialog").send)(new(b("AsyncRequest"))().setURI(h.SHARE_DIALOG_PATH),function(c){new(b("PhotoEditorShareDialog"))(a,c)})};i[c.ROTATE_CW]=function(a){a.rotate(!0)};i[c.ROTATE_CCW]=function(a){a.rotate(!1)};e.exports=d},null);
__d("PhotoEditorDOM",["DOM","Parent","sprintf"],function(a,b,c,d,e,f){var g="data-photoeditoraction",h="["+g+'="%s"]';a={getElementForAction:function(a,c){return b("DOM").find(a,b("sprintf")(h,c))},getActionFromElement:function(a){a=b("Parent").byAttribute(a,g);if(a)return parseInt(a.getAttribute(g),10)}};e.exports=a},null);
__d("PhotoEditorGraphic",["cx","fbt","ArbiterMixin","CSS","DOM","Draggable","Event","PhotoEditorCanvas","PhotoEditorFont","Rect","SimpleDrag","Style","SubscriptionsHandler","Vector","clamp","emptyFunction","mixin","throttle"],function(a,b,c,d,e,f,g,h){var i=0,j=[],k=.7,l=.25,m=30,n=50,o=4,p=.8,q=150,r=5,s=function(a){return{"-webkit-transform":a,"-moz-transform":a,"-ms-transform":a,transform:a}},t=function(a,c){var d=a.x*c.x+a.y*c.y;d=d/(a.magnitude()*c.magnitude());d=b("clamp")(d,-1,1);d=Math.acos(d)*(180/Math.PI);c=a.x*c.y-c.x*a.y;c<0&&(d*=-1);return d},u=function(){"use strict";function a(){var a=this,c;this.root=b("DOM").create("div");(c=b("CSS")).addClass(this.root,"_5g8y");c.addClass(this.root,"_5a2z");var d=b("DOM").create("div");c.addClass(d,"_2fb7");c.addClass(d,"_5a2-");this.root.appendChild(d);this.$1=b("emptyFunction");this.$2=b("emptyFunction");this.$3=b("emptyFunction");c=new(b("SimpleDrag"))(this.root);c.subscribe("start",function(c,d){if(d.button!==0)return!1;a.$4=!0;b("CSS").addClass(a.root,"_2fb8");a.$1(d)});c.subscribe("update",b("throttle")(this.$5,m,this));c.subscribe("end",function(c,d){a.$4=!1,b("CSS").removeClass(a.root,"_2fb8"),b("Style").apply(a.root,s("translate(50%, -50%)")),a.$2(d)})}var c=a.prototype;c.$5=function(a,b){if(!this.$4)return;this.$3(b)};c.setDragStartHandler=function(a){this.$1=a;return this};c.setDragMoveHandler=function(a){this.$3=a;return this};c.setDragEndHandler=function(a){this.$2=a;return this};c.getElement=function(){return this.root};return a}(),v=function(){"use strict";function c(){this.$1=new(b("Vector"))(),this.$2=new XMLSerializer(),this.$3=void 0}var d=c.prototype;d.setDimensions=function(a){this.$1=a;return this};d.render=function(a){a='<svg xmlns="http://www.w3.org/2000/svg" width="'+this.$1.x+'" height="'+this.$1.y+'"><foreignObject width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml">'+this.$2.serializeToString(a)+"</div></foreignObject></svg>";var b=new Image();b.width=this.$1.x;b.height=this.$1.y;b.src=this.$4(a);return b};d.$4=function(b){return"data:image/svg+xml;base64,"+a.btoa(b)};return c}();d=function(a){"use strict";babelHelpers.inheritsLoose(c,a);function c(c,d,e){var f;f=a.call(this)||this;f.id=i++;f.photoEditor=c;j.push(babelHelpers.assertThisInitialized(f));f.root=b("DOM").create("div");f.maxWidth=d;f.maxHeight=e;b("CSS").addClass(f.root,"_55gm");var g=b("DOM").create("button");b("CSS").addClass(g,"_5g8y");b("CSS").addClass(g,"_bbn");b("DOM").setAttributes(g,{"aria-label":h._("Eliminar")});c=b("DOM").create("div");b("CSS").addClass(c,"_2fb7");b("CSS").addClass(c,"_bbo");g.appendChild(c);f.root.appendChild(g);f.$Graphic1=b("DOM").create("div");b("CSS").addClass(f.$Graphic1,"_5lzw");f.$Graphic1.appendChild(f.root);f.$Graphic2=new(b("Vector"))(0,0,"document");f.subscriptionsHandler=new(b("SubscriptionsHandler"))();f.subscriptionsHandler.addSubscriptions(b("Event").listen(g,"click",f.remove.bind(babelHelpers.assertThisInitialized(f))),b("Event").listen(g,"mousedown",function(a){b("CSS").addClass(g,"_2fb8"),a.stopPropagation()}),b("Event").listen(g,"mouseleave",function(a){b("CSS").removeClass(g,"_2fb8")}));return f}var d=c.prototype;d.serialize=function(){var a=this.getPos(),b=this.getDimensions(),c=this.photoEditor.getCanvasDimensions();return{type:this.constructor,left:a.x/c.x,top:a.y/c.y,width:b.x/c.x,height:b.y/c.y,rotation:this.getRotation()}};d.initFromSerializedState=function(a){var c=this.photoEditor.getCanvasDimensions();this.setDimensions(new(b("Vector"))(a.width*c.x,a.height*c.y));this.setPos(new(b("Vector"))(a.left*c.x,a.top*c.y));this.setRotation(a.rotation)};d.onActive=function(){this.__draggable=this.__draggable||new(b("Draggable"))(this.$Graphic1).setUseAbsolute(!0).setUseScroller(!1).addHandle(this.root).setDragHandler(this.onDrag.bind(this)).setDropHandler(this.onDrop.bind(this)),b("CSS").addClass(this.root,"_36w9"),this.updateDraggableBoundingBox()};d.onInactive=function(){this.__draggable&&this.__draggable.destroy(),this.__draggable=null,b("CSS").removeClass(this.root,"_36w9")};d.updateDraggableBoundingBox=function(){if(this.__draggable){var a=this.getDimensions(),c=this.photoEditor.getGraphicsLayer(),d=b("Vector").getElementPosition(c);c=b("Vector").getElementDimensions(c);c=new(b("Rect"))(d.y-.25*a.y,d.x+c.x+.25*a.x,d.y+c.y+.25*a.y,d.x-.25*a.x);this.__draggable.setBoundingBox(c)}};d.onBeforeSuddenTransformation=function(){};d.onAfterSuddenTransformation=function(){};d.getElement=function(){return this.$Graphic1};d.getInitialDimensions=function(){return new(b("Vector"))(this.maxWidth,this.maxHeight,"document").mul(l)};d.getPos=function(){return this.$Graphic2};d.getCenterPos=function(){return this.getPos().add(this.getDimensions().div(2))};d.getCenterCoordinates=function(){return b("Vector").getElementPosition(this.$Graphic1).add(this.getDimensions().div(2))};d.isRemoved=function(){return!this.$Graphic1.parentNode};d.setPos=function(a){this.$Graphic2=a,b("Style").apply(this.$Graphic1,{left:this.$Graphic2.x+"px",top:this.$Graphic2.y+"px"})};d.updatePos=function(){this.setPos(this.getNewPos())};d.getNewPos=function(){return new(b("Vector"))(b("Style").get(this.$Graphic1,"left"),b("Style").get(this.$Graphic1,"top"))};d.setDimensions=function(a){b("Style").apply(this.root,{width:a.x+"px",height:a.y+"px"}),this.updateDraggableBoundingBox()};d.remove=function(a){this.subscriptionsHandler.release(),b("DOM").remove(this.$Graphic1),this.photoEditor.removeGraphic(this)};d.getDrawableObj=function(){};d.getDimensions=function(){return b("Vector").getElementDimensions(this.$Graphic1)};d.getDimensionsForDrawable=function(){return b("Vector").getElementDimensions(this.root)};d.getRotation=function(){return 0};d.setRotation=function(a){};d.onDrag=function(a){};d.onDrop=function(a){this.updatePos()};return c}(b("mixin")(b("ArbiterMixin")));f=function(a){"use strict";babelHelpers.inheritsLoose(c,a);function c(c,d,e,f,g){c=a.call(this,c,e,f)||this;c.$ImageGraphic1=b("DOM").create("div");b("CSS").addClass(c.$ImageGraphic1,"_36wa");c.root.appendChild(c.$ImageGraphic1);c.$ImageGraphic2=e/f;c.$ImageGraphic3=0;c.$ImageGraphic4=0;c.$ImageGraphic5=!0;c.$ImageGraphic6=!0;c.$ImageGraphic7=Math.sqrt(2);c.$ImageGraphic8=!1;c.$ImageGraphic9=new Image();c.$ImageGraphic9.crossOrigin="anonymous";b("Style").apply(c.$ImageGraphic9,{maxWidth:e+"px",maxHeight:f+"px"});b("CSS").addClass(c.root,"_55jn");b("CSS").addClass(c.root,"loading");c.$ImageGraphic10=b("DOM").create("div");b("CSS").addClass(c.$ImageGraphic10,"_5a2y");g||c.$ImageGraphic11();c.subscriptionsHandler.addSubscriptions(b("Event").listen(c.$ImageGraphic9,"load",c.$ImageGraphic12.bind(babelHelpers.assertThisInitialized(c))),b("Event").listen(c.root,"dragenter",b("Event").prevent),b("Event").listen(c.root,"dragover",b("Event").prevent),b("Event").listen(c.$ImageGraphic1,"mousedown",c.$ImageGraphic13.bind(babelHelpers.assertThisInitialized(c))));c.$ImageGraphic9.src=d;c.imageURL=d;c.setDimensions(c.getInitialDimensions());return c}var d=c.prototype;d.serialize=function(){return babelHelpers["extends"]({},a.prototype.serialize.call(this),{imageURL:this.imageURL})};d.getDrawableObj=function(){return this.$ImageGraphic9};d.onDragStart=function(b){a.prototype.onDragStart.call(this,b),b.dataTransfer.setData("text/plain",this.$ImageGraphic9.src)};d.$ImageGraphic11=function(){var a=this,c=new u();this.$ImageGraphic10.appendChild(c.getElement());this.root.appendChild(this.$ImageGraphic10);this.subscriptionsHandler.addSubscriptions(b("Event").listen(c.getElement(),"mousedown",function(a){a.stopPropagation()}));c.setDragStartHandler(function(){a.$ImageGraphic14=a.getCenterCoordinates(),a.$ImageGraphic15()}).setDragMoveHandler(this.$ImageGraphic16.bind(this)).setDragEndHandler(function(){a.$ImageGraphic3=a.$ImageGraphic4,a.$ImageGraphic17(),a.$ImageGraphic18()});this.$ImageGraphic19=c};d.$ImageGraphic16=function(a){a=b("Vector").getEventPosition(a);var c=this.getDimensions(),d=c.magnitude();d=c.div(d);var e=this.$ImageGraphic14,f=e.distanceTo(a);f=b("clamp")(f*2,n,Math.max(this.maxWidth,this.maxHeight))*this.$ImageGraphic7;f=d.mul(f);f.x=f.y*this.$ImageGraphic20;c=f.sub(c);if(c.magnitude()>o){c=this.getPos().sub(c.div(2));this.setDimensions(f);this.setPos(c)}if(this.$ImageGraphic5===!0){f=a.sub(e);c=d.mul(1,-1);a=t(c,f);this.$ImageGraphic21(a)}this.updatePos();this.$ImageGraphic22&&this.$ImageGraphic22()};d.setPostFreeformEditDragHandler=function(a){this.$ImageGraphic22=a};d.$ImageGraphic21=function(a){this.$ImageGraphic4=this.$ImageGraphic3+a,b("Style").apply(this.$ImageGraphic1,s("rotate("+this.$ImageGraphic4+"deg)")),this.$ImageGraphic23(this.$ImageGraphic24+a),b("Style").apply(this.$ImageGraphic19.getElement(),s("translate(50%, -50%) rotate("+a+"deg)"))};d.$ImageGraphic18=function(){this.$ImageGraphic23(this.$ImageGraphic24)};d.$ImageGraphic17=function(){b("Style").set(this.$ImageGraphic10,"transition","transform 0.3s cubic-bezier(.08,.98,.15,1.09)")};d.$ImageGraphic15=function(){b("Style").set(this.$ImageGraphic10,"transition","")};d.$ImageGraphic23=function(a){b("Style").apply(this.$ImageGraphic10,s("rotate("+a+"deg) translateX("+this.getDimensions().magnitude()/(2*this.$ImageGraphic7)+"px) rotate("+-1*a+"deg)"))};d.$ImageGraphic13=function(a){this.photoEditor.setActiveGraphic(this)};d.$ImageGraphic12=function(){b("CSS").removeClass(this.root,"loading");b("CSS").addClass(this.root,"loaded");this.$ImageGraphic2=this.$ImageGraphic9.width/this.$ImageGraphic9.height;var a=new(b("PhotoEditorCanvas"))();a.setImageContent(this.$ImageGraphic9);b("Style").set(this.$ImageGraphic1,"backgroundImage","url("+a.toDataURL()+")");this.setDimensions(this.getDimensions());this.updatePos();this.inform("loaded")};d.setPos=function(c){a.prototype.setPos.call(this,c);c=this.$ImageGraphic25();b("Style").apply(this.$ImageGraphic1,{left:c.x+"px",top:c.y+"px"})};d.setDimensions=function(a){this.$ImageGraphic20=this.$ImageGraphic6?1:a.x/a.y;b("Style").apply(this.root,{height:(this.$ImageGraphic6?a.x:a.y)+"px",width:a.x+"px"});this.$ImageGraphic24=-Math.atan2(a.y,a.x)*180/Math.PI;var c=this.getImageScale();a=new(b("Vector"))(a.x,this.$ImageGraphic6?a.x:a.y).mul(c.x,c.y);b("Style").apply(this.$ImageGraphic1,{height:Math.round(a.y)+"px",width:Math.round(a.x)+"px"});this.$ImageGraphic18();this.updateDraggableBoundingBox()};d.getImageScale=function(){var a=this.$ImageGraphic2>1?new(b("Vector"))(1,1/this.$ImageGraphic2):new(b("Vector"))(this.$ImageGraphic2,1);return a.mul(k)};d.$ImageGraphic25=function(){var a=this.getDimensions(),b=this.getDimensionsForDrawable();return a.sub(b).div(2)};d.getInitialDimensions=function(){var a=Math.min(this.maxWidth,this.maxHeight);return new(b("Vector"))(a,a,"document").mul(l)};d.getDimensionsForDrawable=function(){return b("Vector").getElementDimensions(this.$ImageGraphic1)};d.getRotation=function(){return this.$ImageGraphic4};d.setRotation=function(a){this.$ImageGraphic3=this.$ImageGraphic4=a,b("Style").apply(this.$ImageGraphic1,s("rotate("+this.$ImageGraphic3+"deg)"))};d.setAllowRotation=function(a){this.$ImageGraphic5=a;return this};d.setCircleBoundingBox=function(a){this.$ImageGraphic6=a;this.$ImageGraphic7=a?Math.sqrt(2):1;return this};d.onBeforeSuddenTransformation=function(){this.$ImageGraphic15()};d.onAfterSuddenTransformation=function(){this.$ImageGraphic17()};return c}(d);g=function(a){"use strict";babelHelpers.inheritsLoose(c,a);function c(b,c,d,e,f,g){b=a.call(this,b,d,e,f,g)||this;b.$StickerGraphic1=c;return b}var d=c.prototype;d.serialize=function(){return babelHelpers["extends"]({},a.prototype.serialize.call(this),{sticker_id:this.$StickerGraphic1})};d.onActive=function(){a.prototype.onActive.call(this),b("CSS").addClass(this.photoEditor.getCanvasWrapper(),"_61d-")};d.onInactive=function(){a.prototype.onInactive.call(this),b("CSS").removeClass(this.photoEditor.getCanvasWrapper(),"_61d-")};return c}(f);var w=function(c){"use strict";babelHelpers.inheritsLoose(a,c);function a(d,e,f,g,h,i,j,k,l,m){var n;n=c.call(this,d,k,l)||this;n.$TextGraphic1=new Image();n.$TextGraphic2=g;n.$TextGraphic3=new(b("PhotoEditorFont"))(f);n.$TextGraphic4=null;n.$TextGraphic5=0;n.$TextGraphic6=1;n.$TextGraphic7=0;n.$TextGraphic8=new v().setDimensions(a.ImageSettings.DIMENSIONS);n.$TextGraphic9=i;n.$TextGraphic10=b("DOM").create("textarea");b("Style").apply(n.$TextGraphic10,{position:"absolute",width:a.ImageSettings.WIDTH+"px",padding:"0px",margin:"0px",border:"none",overflow:"hidden",resize:"none",background:"transparent"});j=b("DOM").create("div",{className:"_3bul"});b("Style").set(j,"width",a.ImageSettings.WIDTH+"px");j.appendChild(n.$TextGraphic10);n.root.appendChild(j);n.$TextGraphic11=h||new(b("Vector"))(0,0,"document");n.focusInput=b("DOM").create("textarea",{className:"_5g78"});n.$TextGraphic12=b("DOM").create("div",{className:"_5l-2"});n.root.appendChild(n.focusInput);n.root.appendChild(n.$TextGraphic12);b("CSS").addClass(n.root,"loaded");b("CSS").addClass(n.root,"_5g79");n.subscriptionsHandler.addSubscriptions(b("Event").listen(n.$TextGraphic12,"click",function(){n.focusInput.focus()}),b("Event").listen(n.focusInput,"blur",function(){b("CSS").removeClass(n.root,"_5g7a")}),b("Event").listen(n.focusInput,"focus",function(){d.setActiveGraphic(babelHelpers.assertThisInitialized(n)),b("CSS").addClass(n.root,"_5g7a"),n.adjustFontSizeFit()}),b("Event").listen(n.focusInput,"keyup",b("throttle")(n.$TextGraphic13,50,babelHelpers.assertThisInitialized(n))));m||n.$TextGraphic14();g=Math.min(k,l)*p;f=g/a.ImageSettings.WIDTH;n.$TextGraphic6=f;n.$TextGraphic15=new(b("Vector"))(g,f*a.ImageSettings.HEIGHT,"document");n.$TextGraphic15.setElementDimensions(n.root);n.updateText(e);return n}var d=a.prototype;d.getInitialDimensions=function(){return this.$TextGraphic15};d.$TextGraphic16=function(a){if(this.$TextGraphic17!==!0){var c=b("Vector").getEventPosition(a),d=this.getDimensions(),e=d.magnitude();e=d.div(e);var f=this.$TextGraphic18,g=f.distanceTo(c),h=this.photoEditor.getCanvasDimensions();h=Math.max(h.x,h.y);g=b("clamp")(g*2,n,h);h=e.mul(g);e=h.sub(d);if(e.magnitude()>o){g=this.getPos().sub(e.div(2));this.setDimensions(h);this.setPos(g)}e=f.sub(c);h=t(d.mul(-1,1),e);h=(h+360)%360;(h%90<r||h%90>90-r)&&(h=Math.round(h/90)*90);this.setRotation(h);this.updateDraggableBoundingBox();this.updatePos()}else originalDims=this.getDimensions(),cursorPos=b("Vector").getEventPosition(a),center=this.$TextGraphic18,distToCenter=center.sub(cursorPos),newDims=distToCenter.mul(-2,2),diff=newDims.sub(originalDims),diff.magnitude()>o&&(newPos=this.getPos().sub(diff.div(2)),this.setDimensions(newDims),this.setPos(newPos));this.$TextGraphic19&&this.$TextGraphic19()};d.setPostFreeformEditDragHandler=function(a){this.$TextGraphic19=a};d.$TextGraphic14=function(){var a=this,c=new u();this.root.appendChild(c.getElement());this.subscriptionsHandler.addSubscriptions(b("Event").listen(c.getElement(),"mousedown",function(a){a.stopPropagation()}));c.setDragStartHandler(function(){a.$TextGraphic18=a.getCenterCoordinates()}).setDragMoveHandler(this.$TextGraphic16.bind(this))};d.setAllowChangeAspectRatio=function(a){this.$TextGraphic17=a};d.$TextGraphic13=function(){var a=this.focusInput.value;a.length>q&&(this.focusInput.value=a.substr(0,q));this.updateText(this.focusInput.value)};d.onActive=function(){c.prototype.onActive.call(this),this.focusInput.focus(),this.inform("focus")};d.onInactive=function(){c.prototype.onInactive.call(this);this.focusInput.blur();b("CSS").removeClass(this.root,"_5g7a");this.inform("blur");var a=this.$TextGraphic4.replace(/^\s*/,"").replace(/\s*$/,"");a.length||this.remove()};d.getRotation=function(){return this.$TextGraphic5};d.setRotation=function(a){this.$TextGraphic5=a,b("Style").apply(this.root,s("rotate("+this.$TextGraphic5+"deg)"))};d.setDimensions=function(c){this.$TextGraphic6=c.x/a.ImageSettings.WIDTH,b("Style").apply(this.root,{width:c.x+"px",height:this.$TextGraphic6*a.ImageSettings.HEIGHT+"px"}),this.$TextGraphic20()};d.getDrawableObj=function(){return this.$TextGraphic1};d.getTextAlign=function(){return this.$TextGraphic9};d.getText=function(){return this.$TextGraphic4};d.getFillStyle=function(){return this.$TextGraphic2};d.getFontFamily=function(){return this.$TextGraphic3.getFamily()};d.updateText=function(a,c,d){d&&(this.$TextGraphic2=d),c&&this.$TextGraphic3.setFamily(c),typeof a==="string"&&(a=a.substr(0,q),this.$TextGraphic4!=a&&(this.focusInput.value=this.$TextGraphic4=a,this.$TextGraphic10.innerText=this.$TextGraphic10.textContent=a)),b("Style").apply(this.focusInput,{textAlign:this.$TextGraphic9,color:this.$TextGraphic2,fontFamily:this.$TextGraphic3.getFamily()}),b("Style").apply(this.$TextGraphic10,{textAlign:this.$TextGraphic9,font:this.$TextGraphic3.toString(),color:this.$TextGraphic2}),this.adjustFontSizeFit(),this.$TextGraphic1=this.$TextGraphic8.render(this.$TextGraphic10)};d.adjustFontSizeFit=function(){var c=a.ImageSettings.MAX_FONT;this.$TextGraphic3.setSize(c);b("Style").apply(this.$TextGraphic10,{font:this.$TextGraphic3.toString(),height:"0px"});while(this.$TextGraphic10.scrollHeight>a.ImageSettings.HEIGHT)this.$TextGraphic3.setSize(--c),b("Style").set(this.$TextGraphic10,"font",this.$TextGraphic3.toString());this.$TextGraphic7=(a.ImageSettings.HEIGHT-this.$TextGraphic10.scrollHeight)/2;b("Style").apply(this.$TextGraphic10,{marginTop:this.$TextGraphic7+"px",marginBottom:this.$TextGraphic7+"px",height:this.$TextGraphic10.scrollHeight+"px"});this.$TextGraphic20()};d.setFontSize=function(a){this.$TextGraphic3.setSize(a)};d.$TextGraphic20=function(){var c=this,d=this.$TextGraphic6,e=this.$TextGraphic10.clientHeight;window.setTimeout(function(){b("Style").apply(c.focusInput,{width:a.ImageSettings.WIDTH*d+"px",height:e*d+"px",marginTop:c.$TextGraphic7*d+"px",marginBottom:c.$TextGraphic7*d+"px",fontSize:c.$TextGraphic3.getSize()*d+"px"})},0)};d.setTextAlign=function(a){this.$TextGraphic9=a;this.updateText();return this};d.setText=function(a){this.updateText(a)};d.setFontFamily=function(a){this.$TextGraphic3.setFamily(a),this.updateText()};d.setFillStyle=function(a){this.$TextGraphic2=a,this.updateText()};d.getColorCoordinates=function(){return new(b("Vector"))(this.$TextGraphic11.x,this.$TextGraphic11.y,"document")};d.setColorCoordinates=function(a){this.$TextGraphic11=a};d.serialize=function(){return babelHelpers["extends"]({},c.prototype.serialize.call(this),{text:this.$TextGraphic4,fontFamily:this.$TextGraphic3.getFamily(),fill:this.$TextGraphic2,textAlign:this.$TextGraphic9,colorCoordinates:{x:this.$TextGraphic11.x,y:this.$TextGraphic11.y}})};d.initFromSerializedState=function(a){this.$TextGraphic9=a.textAlign,this.$TextGraphic11=a.colorCoordinates,this.updateText(a.text,a.fontFamily,a.fill),c.prototype.initFromSerializedState.call(this,a)};return a}(d);w.ImageSettings={WIDTH:200,HEIGHT:120,MAX_FONT:30,DIMENSIONS:new(b("Vector"))(200,120)};var x=function(c){"use strict";babelHelpers.inheritsLoose(b,c);function b(){return c.apply(this,arguments)||this}var d=b.prototype;d.remove=function(){c.prototype.remove.call(this),a.URL.revokeObjectURL(this.imageURL)};return b}(f);function c(a,b){j[a]&&j[a].onDrop(b)}e.exports={Blob:x,FreeFormEditButton:u,Graphic:d,Image:f,onDrop:c,Sticker:g,Text:w}},null);
__d("PhotoEditor",["cx","ArbiterMixin","AsyncDialog","AsyncRequest","CSS","DOM","DragDropTarget","EncryptedImg","Event","PhotoEditorButtonHandler","PhotoEditorCanvas","PhotoEditorConfig","PhotoEditorDOM","PhotoEditorGraphic","Style","SubscriptionsHandler","URI","Vector","emptyFunction","mixin","removeFromArray"],function(a,b,c,d,e,f,g){var h,i=b("PhotoEditorConfig").Constants,j=null,k=90,l=Math.PI/2,m=function(d){"use strict";babelHelpers.inheritsLoose(c,d);function c(a){var c;c=d.call(this)||this;c.__constructorInit__FIXME();c.root=a;c.workingCanvas=new(b("PhotoEditorCanvas"))(babelHelpers.assertThisInitialized(c));c.layers=[];c.activeGraphic=null;c.rotations=0;c.buttonHandler=new(b("PhotoEditorButtonHandler"))(babelHelpers.assertThisInitialized(c));c.originalImage=null;c.filteredImage=new(b("PhotoEditorCanvas"))(babelHelpers.assertThisInitialized(c));c.canvasWrapperEl=null;c.lastCropState=null;c.filter=null;c.automaticAltText=null;c.customAccessibilityCaption=null;c.drawingSubscriptionsHandler=new(b("SubscriptionsHandler"))();c.setCurrentFillStyle("white");c.setCurrentBrushSize(5);c.initDOM();c.reset();j=babelHelpers.assertThisInitialized(c);b("CSS").addClass(c.canvasWrapperEl,"_5981");b("CSS").addClass(c.workingCanvas.getElement(),c.getCanvasClass());return c}var e=c.prototype;e.__constructorInit__FIXME=function(){};e.serialize=function(){var a=this.layers.map(function(a){return a.serialize()});return{graphics:a,numRotations:this.getNumRotations(),cropDimensions:this.getCropDimensions(),filter:this.getFilter(),customAccessibilityCaption:this.getCustomAccessibilityCaption()}};e.getCanvasClass=function(){return"_5982"};e.initDOM=function(){};e.updateBrushConfigVisibility=function(a){};e.getCropDimensions=function(){return{x:0,y:0,width:this.originalImage.width,height:this.originalImage.height}};e.getRoot=function(){return this.root};e.getCanvasWrapper=function(){return this.canvasWrapperEl};e.getGraphicsLayer=function(){return this.canvasWrapperEl};e.setActiveGraphic=function(a){if(this.activeGraphic===a)return;var b=this.activeGraphic;this.activeGraphic=a;b&&b.onInactive();this.activeGraphic&&this.activeGraphic.onActive()};e.setImage=function(a){this.workingCanvas.setImageContent(a),this.filteredImage.setImageContent(a),b("Style").apply(this.canvasWrapperEl,{width:a.width+"px",height:a.height+"px"}),b("DOM").appendContent(this.canvasWrapperEl,this.workingCanvas.getElement()),this._drawingHandler&&this.canvasWrapperEl.appendChild(this._drawingHandler.getCursorElement()),this.originalImage=a};e.registerEventDelegate=function(a){return b("Event").listen(a,"click",this.handleDelegateClick.bind(this),b("Event").Priority.URGENT)};e.handleDelegateClick=function(a){var c=a.getTarget(),d=b("PhotoEditorDOM").getActionFromElement(c);if(!d)return;d=this.buttonHandler.handleAction(d,c);d||a.prevent()};e.getButtonHandler=function(a,b){return this.buttonHandler};e.loadPhoto=function(a){var c=this,d=new Image();d.crossOrigin="anonymous";this.imageLoadRef&&this.imageLoadRef.remove();b("EncryptedImg").isEncrypted(a)?(this.imageLoadRef=function(a){d&&(d.src=a),c.onImageLoaded(d)},b("EncryptedImg").load(a,this.imageLoadRef)):(this.imageLoadRef=b("Event").listen(d,"load",this.onImageLoaded.bind(this,d)),d.src=a)};e.onImageLoaded=function(a){this.setImage(a)};e.getImageDimensions=function(){if(this.isInverted)return new(b("Vector"))(this.workingCanvas.getHeight(),this.workingCanvas.getWidth());else return new(b("Vector"))(this.workingCanvas.getWidth(),this.workingCanvas.getHeight())};e.getCanvasDimensions=function(){if(this.isInverted)return new(b("Vector"))(this.canvasWrapperEl.offsetHeight,this.canvasWrapperEl.offsetWidth);else return new(b("Vector"))(this.canvasWrapperEl.offsetWidth,this.canvasWrapperEl.offsetHeight)};e.reset=function(){b("CSS").removeClass(this.canvasWrapperEl,this.getRotateClass()),this.workingCanvas.clear(),this.rotations=0,this.isInverted=!1};e.rotate=function(a){b("CSS").removeClass(this.canvasWrapperEl,this.getRotateClass()),this.rotations+=a?1:3,this.rotations%=4,this.rotations&&b("CSS").addClass(this.canvasWrapperEl,this.getRotateClass()),this.rotateGraphics(a),this.isInverted=!this.isInverted};e.rotateGraphics=function(a){var c=this,d=a?Math.PI/2:Math.PI/-2;this.layers.forEach(function(a){var e=c.getCanvasDimensions().div(2),f=a.getCenterPos().sub(e);f=new(b("Vector"))(f.x*Math.cos(d)-f.y*Math.sin(d),f.x*Math.sin(d)+f.y*Math.cos(d));f=f.sub(a.getDimensions().div(2));e=new(b("Vector"))(e.y,e.x);a.setPos(e.add(f));a.setRotation(a.getRotation()+d*180/Math.PI)})};e.getIsInverted=function(){return this.isInverted};e.getNumRotations=function(){return this.rotations};e.getRotationAngle=function(){return this.rotations*l};e.getRotateClass=function(){return"rot"+this.rotations*k};e.removeGraphic=function(a){this.activeGraphic===a&&this.setActiveGraphic(null),b("removeFromArray")(this.layers,a)};e._getRandomPosForGraphic=function(a){return b("Vector").getElementDimensions(this.getGraphicsLayer()).sub(a.getInitialDimensions()).mul(Math.random()/2,Math.random()/2)};e.addGraphic=function(a,b){this.layers.push(a);b||(b=this._getRandomPosForGraphic(a));this.getGraphicsLayer().appendChild(a.getElement());a.setPos(b);this._enableGraphicsDragDrop();return a};e.addBlobGraphic=function(a,c){var d=this.getCanvasDimensions();return this.addGraphic(new(b("PhotoEditorGraphic").Blob)(this,a,d.x,d.y),c)};e.addImageGraphic=function(a,c){var d=this.getCanvasDimensions();return this.addGraphic(new(b("PhotoEditorGraphic").Image)(this,a,d.x,d.y),c)};e.addStickerGraphic=function(a,c,d){var e=this.getCanvasDimensions();return this.addGraphic(new(b("PhotoEditorGraphic").Sticker)(this,a,c,e.x,e.y),d)};e.addTextGraphic=function(a,c,d,e,f,g){var h=this.getCanvasDimensions();return this.addGraphic(new(b("PhotoEditorGraphic").Text)(this,a,c,d||i.DEFAULT_FILL_STYLE,e,f||i.DEFAULT_TEXT_ALIGN,this.canvasWrapperEl,h.x,h.y),g)};e.addAutomaticAltText=function(a){this.automaticAltText=a};e.addCustomAccessibilityCaption=function(a){typeof a==="string"&&(this.customAccessibilityCaption=a)};e.addFilter=function(a,c,d){var e=this,f=new(b("PhotoEditorCanvas"))().setImageContent(this.originalImage);c=c||b("emptyFunction");d=d||b("emptyFunction");new a().run(f,function(b){var d=e.lastCropState||e.getCropDimensions();e.filteredImage=f;e.filter=a;e.crop(d.x,d.y,d.width,d.height);c(b)},d)};e.removeFilter=function(){var a=this.lastCropState||this.getCropDimensions();this.filter=null;this.filteredImage.setImageContent(this.originalImage);this.crop(a.x,a.y,a.width,a.height)};e.getFilter=function(){return this.filter};e.getAutomaticAltText=function(){return this.automaticAltText};e.getCustomAccessibilityCaption=function(){return this.customAccessibilityCaption};e.crop=function(a,c,d,e){var f=this.getResizeFactor(),g=this.lastCropState||this.getCropDimensions(),h=a-g.x,i=c-g.y,j=g.width-d-h;g=g.height-e-i;var k=new(b("Vector"))(h,i);this.rotations==1?k=new(b("Vector"))(g,h):this.rotations==2?k=new(b("Vector"))(j,g):this.rotations==3&&(k=new(b("Vector"))(i,j));this.layers.forEach(function(a){a.setPos(a.getPos().sub(k.mul(f)))});this.workingCanvas.setImageContent(this.filteredImage.getElement());this.workingCanvas.crop(a,c,d,e);this.workingCanvas.getDimensions().mul(f).setElementDimensions(this.canvasWrapperEl);this.lastCropState={x:a,y:c,width:d,height:e};this.resize()};e.getWorkingCanvas=function(){return this.workingCanvas};e.getOriginalImage=function(){return this.originalImage};e.setCurrentFillStyle=function(a){this.fillStyle=a,this._drawingHandler&&this._drawingHandler.setFillStyle(a)};e.getCurrentFillStyle=function(){return this.fillStyle};e.setCurrentBrushSize=function(a){this.brushSize=a,this._drawingHandler&&this._drawingHandler.setBrushSize(a)};e.getCurrentBrushSize=function(){return this.brushSize};e.getPreviewCanvas=function(a){return this.getFlattenedCanvas().scaledCopy(a)};e.getResizeFactor=function(){return this.canvasWrapperEl.offsetWidth/this.workingCanvas.getWidth()};e.revert=function(){this.workingCanvas.setImageContent(this.originalImage);for(var a=0;a<this.layers.length;a++)this.layers[a].remove();this.layers=[]};e.toDataURL=function(){return this.getFlattenedCanvas().toDataURL()};e.toBase64=function(){return this.getFlattenedCanvas().toBase64()};e.toBlob=function(a){this.getFlattenedCanvas().toBlob(a)};e.toBlobURI=function(a){this.getFlattenedCanvas().toBlobURI(a)};e.toURL=function(a){this.getFlattenedCanvas().toURL(a)};e.getFlattenedCanvas=function(){var a=this.workingCanvas.getWidth(),c=this.workingCanvas.getHeight(),d=new(b("PhotoEditorCanvas"))(),e=d.getContext(),f,g;this.rotations?(this.rotations%2?(f=c/2,g=a/2,d.setWidth(c).setHeight(a)):(f=a/2,g=c/2,d.setWidth(a).setHeight(c)),e.translate(f,g),e.rotate(this.rotations*l),this.rotations%2?e.translate(-g,-f):e.translate(-f,-g),d.drawGraphic(this.workingCanvas.getElement(),0,0),this.rotations%2?e.translate(g,f):e.translate(f,g),e.rotate(-1*this.rotations*l),e.translate(-f,-g)):d.setImageContent(this.workingCanvas.getElement());var h;for(var a=0;a<this.layers.length;a++)c=this.layers[a],f=c.getCenterPos().div(this.getResizeFactor()),g=c.getDimensionsForDrawable().div(this.getResizeFactor()),h=c.getDrawableObj(),c=c.getRotation(),e.save(),e.translate(f.x,f.y),e.rotate(c*Math.PI/180),d.drawGraphic(h,g.x/-2,g.y/-2,g.x,g.y),e.restore();return d};e.save=function(a){a.stage=this.getFlattenedCanvas().toBase64();a=new(b("AsyncRequest"))().setURI(new(h||(h=b("URI")))(i.SAVE_PATH).getPath()).setData(a).setMethod("POST").setRelativeTo(this.root);b("AsyncDialog").send(a)};e.saveInAlbum=function(a){this.save({album_id:a})};e.saveAsProfPic=function(){this.save({profile_pic:1})};e.enableDrawing=function(a,c,d){this.drawingSubscriptionsHandler.engage(),this.drawingSubscriptionsHandler.addSubscriptions(b("Event").listen(this.canvasWrapperEl,"mousemove",this._onMouseMove.bind(this)),b("Event").listen(this.canvasWrapperEl,"mouseleave",this._onMouseLeave.bind(this))),this._drawingHandler=this.workingCanvas.enableDrawing(a,c),b("CSS").hide(this._drawingHandler.getCursorElement()),b("CSS").addClass(this.canvasWrapperEl,"_5ewy"),this.canvasWrapperEl.appendChild(this._drawingHandler.getCursorElement())};e.disableDrawing=function(){this.drawingSubscriptionsHandler.release(),this.workingCanvas.disableDrawing(),b("CSS").removeClass(this.canvasWrapperEl,"_5ewy"),b("DOM").remove(this._drawingHandler.getCursorElement()),this._drawingHandler=null};e._onMouseLeave=function(){b("CSS").hide(this._drawingHandler.getCursorElement())};e._onMouseMove=function(a){b("Vector").getEventPosition(a).sub(b("Vector").getElementPosition(this.canvasWrapperEl)).sub(this._drawingHandler.getDrawingCursor().getDimensions().div(2)).setElementPosition(this._drawingHandler.getCursorElement()),b("CSS").show(this._drawingHandler.getCursorElement())};e._enableGraphicsDragDrop=function(){if(this._isGraphicDragDropEnabled)return;b("Event").listen(this.canvasWrapperEl,"dragenter",b("Event").prevent);b("Event").listen(this.canvasWrapperEl,"dragover",b("Event").prevent);b("Event").listen(this.canvasWrapperEl,"drop",this._onDrop.bind(this))};e._onDrop=function(a){var c=a.dataTransfer.getData("graphic_id");c&&b("PhotoEditorGraphic").onDrop(c,a)};e.enableTextAndImageFileDragDrop=function(){var c=this;this._dragDropTarget||(this._dragDropTarget=new(b("DragDropTarget"))(this.canvasWrapperEl).setOnDropCallback(function(d,e){var f=d.files||[];d=d.plainText;var g=e.dataTransfer.getData("graphic_id");if(g)return;g=b("Vector").getEventPosition(e).sub(b("Vector").getElementPosition(c.canvasWrapperEl));if(f.length==1)c.addBlobGraphic(a.URL.createObjectURL(f[0]),g);else if(f.length)for(var e=0;e<f.length;e++)c.addBlobGraphic(a.URL.createObjectURL(f[e]));else d&&c.addTextGraphic(d,"Arial",g)}).setFileFilter(function(a){var b=[];for(var c=0;c<a.length;c++)a[c].type.match("image/*")&&b.push(a[c]);return b}));this._dragDropTarget.enable()};e.disableTextAndImageFileDragDrop=function(){this._dragDropTarget&&this._dragDropTarget.disable()};return c}(b("mixin")(b("ArbiterMixin")));m.addImageGraphic=function(a){m.getInstance().addImageGraphic(a)};m.addGraphicFromBrowser=function(a){a=a.getElementsByTagName("IMG")[0].getAttribute("src");return m.getInstance().addImageGraphic(a)};m.saveInAlbum=function(a){m.getInstance().saveInAlbum(a.getAttribute("data-albumid"))};m.getInstance=function(){return j};e.exports=m},null);
__d("PhotoEditorSessionLogging",["AsyncRequest","PhotoEditorConfig"],function(a,b,c,d,e,f){var g=b("PhotoEditorConfig").Constants;a=function(){"use strict";function a(a,b){this.$1={context:a,is_editing:b,events:{},photo_saved:!1},this.$2=0,this.$3=!1}var c=a.prototype;c.start=function(){this.$2=Date.now();return this};c.end=function(a){if(this.$3)return;this.$3=!0;this.$1.duration=Date.now()-this.$2;new(b("AsyncRequest"))().setURI(g.LOGGING_PATH).setAllowCrossPageTransition(!0).setOption("suppressErrorHandlerWarning",!0).setOption("asynchronous_DEPRECATED",a).setData(this.$1).send();return this};c.logPhotoSaved=function(){this.$1.photo_saved=!0};c.logEvent=function(a){!(a in this.$1.events)?this.$1.events[a]=1:this.$1.events[a]++;return this};return a}();e.exports=a},null);
__d("ModalPhotoEditorCancelDialog.react",["fbt","XUIDialogBody.react","XUIDialogButton.react","XUIDialogCancelButton.react","XUIDialogFooter.react","XUIDialogTitle.react","prop-types","react"],function(a,b,c,d,e,f,g,h){var i=d("react");a=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}var d=b.prototype;d.render=function(){return i.jsxs("div",{children:[i.jsx(c("XUIDialogTitle.react"),{showCloseButton:!1,children:h._("\u00bfDescartar cambios?")}),i.jsx(c("XUIDialogBody.react"),{children:h._("\u00bfSeguro que quieres descartar todos tus cambios?")}),i.jsxs(c("XUIDialogFooter.react"),{children:[i.jsx(c("XUIDialogCancelButton.react"),{}),i.jsx(c("XUIDialogButton.react"),{onClick:this.props.onConfirm,action:"cancel",use:"confirm",label:h._("Descartar")})]})]})};return b}(i.Component);a.propTypes={onConfirm:c("prop-types").func.isRequired};g["default"]=a},98);
__d("ModalPhotoEditorCaptionInput.react",["cx","fbt","AbstractTextArea.react","FunnelLogger","XUIButton.react","XUINotice.react","joinClasses","react"],function(a,b,c,d,e,f,g,h,i){"use strict";var j=d("react");a=function(a){babelHelpers.inheritsLoose(b,a);function b(b){var c;c=a.call(this,b)||this;c.state={show_editor:c.props.defaultValue!==null&&c.props.defaultValue!=="",warning_msg:c.props.defaultValue?c.props.defaultValue.length>=c.props.charLimit:!1};c.$5=function(a){if(typeof a.target.value==="string"){var b=a.target.value.trim(),d=c.state.warning_msg;c.$1=a.target.value;c.props.onChange(b);b.length>=c.props.charLimit&&!d?c.setState({warning_msg:!0}):d&&b.length<c.props.charLimit&&c.setState({warning_msg:!1})}};c.$3=function(){d("FunnelLogger").appendAction("WWW_ALT_TEXT_COMPOSER_FUNNEL","[Caption Tab] override button");var a=c.$1?c.$1.length>=c.props.charLimit:!1;c.setState({show_editor:!0,warning_msg:a})};c.$4=function(){d("FunnelLogger").appendAction("WWW_ALT_TEXT_COMPOSER_FUNNEL","[Caption Tab] cancel button"),c.props.onClear(),c.setState({show_editor:!1,warning_msg:!1})};c.$1=c.props.defaultValue;c.$2=j.createRef();return c}var e=b.prototype;e.componentDidUpdate=function(a,b){!b.show_editor&&this.state.show_editor&&(this.$2&&this.$2.current&&this.$2.current.focusInput())};e.render=function(){var a,b,d,e;if(!this.state.show_editor&&this.props.automaticAltText)a=j.jsx("div",{children:j.jsx(c("XUIButton.react"),{className:"_orx",label:i._("Reemplazar texto alternativo generado"),onClick:this.$3})});else{var f;if(this.props.automaticAltText){var g="_vo6";f=j.jsx(c("XUIButton.react"),{label:i._("Borrar"),onClick:this.$4,className:g})}b=j.jsxs("div",{children:[j.jsx(c("AbstractTextArea.react"),{autoGrow:!0,defaultValue:this.$1,leftChild:j.jsx("span",{className:"accessible_elem",children:i._("Texto alternativo")}),onChange:this.$5,className:c("joinClasses")("_2phz",this.props.className),ref:this.$2}),f]})}this.props.automaticAltText&&(d=j.jsxs("div",{children:[j.jsx("div",{className:"_3-8n",children:i._("El texto alternativo generado autom\u00e1ticamente para esta foto es:")}),j.jsx("i",{children:this.props.automaticAltText})]}));this.state.warning_msg&&(e=j.jsx("div",{className:"_6484",children:j.jsx(c("XUINotice.react"),{use:"recommend",size:"small",children:i._("Los textos alternativos suelen contener menos de {char_limit} caracteres.",[i._param("char_limit",this.props.charLimit)])})}));return j.jsxs("div",{children:[d,j.jsx("div",{className:"_3-8n",children:i._("A\u00f1ade un texto alternativo en el que se describa el contenido de la foto para las personas con problemas de visi\u00f3n.")}),a,b,e]})};return b}(j.Component);a.defaultProps={charLimit:100,onClear:function(){}};g["default"]=a},98);
__d("ModalPhotoEditorTabBase",["cx","invariant","DOM","Link.react","ReactDOM","joinClasses","react"],function(a,b,c,d,e,f,g,h){var i,j=i||b("react");a=function(){"use strict";function a(a){this.editor=a,this.$1=this.createPanelContents(),this.$2=b("DOM").create("div"),b("ReactDOM").render(this.$3(),this.$2)}var c=a.prototype;c.getLabel=function(){return""};c.getName=function(){h(0,5820)};c.getIconClassName=function(){return""};c.onActive=function(){};c.onLeave=function(){};c.onImageLoaded=function(){};c.onTabButtonClicked=function(){};c.createPanelContents=function(){};c.$4=function(){this.onTabButtonClicked(),this.editor.setActiveTab(this)};c.getPanelContents=function(){return this.$1};c.getTabButton=function(){return this.$2};c.$3=function(){return j.jsxs(b("Link.react"),{role:"tab",className:"_1hx3",onClick:this.$4.bind(this),children:[j.jsx("div",{className:b("joinClasses")("_1hx4",this.getIconClassName())}),j.jsx("div",{className:"_1hx5",children:this.getLabel()})]})};return a}();e.exports=a},null);
__d("ModalPhotoEditorCaptionTab",["cx","fbt","DOM","FunnelLogger","ModalPhotoEditorCaptionInput.react","ModalPhotoEditorTabBase","PhotoEditorSaveStates","ReactDOM","react"],function(a,b,c,d,e,f,g,h,i){var j=d("react");a=function(a){babelHelpers.inheritsLoose(b,a);function b(b){b=a.call(this,b)||this;b.initialCaption=null;d("FunnelLogger").startFunnel("WWW_ALT_TEXT_COMPOSER_FUNNEL");return b}var e=b.prototype;e.getName=function(){return"custom_accessibility_caption"};e.getLabel=function(){return i._("Texto alternativo")};e.getIconClassName=function(){return"_3tzj"};e.createPanelContents=function(){var a=c("DOM").create("div"),b=c("DOM").create("div"),e=d("PhotoEditorSaveStates").getState(this.editor.photoFBID),f=this.editor.getAutomaticAltText();this.initialCaption=e?e.customAccessibilityCaption:null;d("ReactDOM").render(j.jsx("div",{children:j.jsx(c("ModalPhotoEditorCaptionInput.react"),{automaticAltText:f,className:"_2siz",defaultValue:this.initialCaption,onChange:this.$ModalPhotoEditorCaptionTab1.bind(this),onClear:this.$ModalPhotoEditorCaptionTab2.bind(this)})}),b);a.appendChild(b);return a};e.$ModalPhotoEditorCaptionTab2=function(){this.editor.addCustomAccessibilityCaption("")};e.$ModalPhotoEditorCaptionTab1=function(a){a!==this.initialCaption&&a!==this.editor.getAutomaticAltText()&&this.editor.addCustomAccessibilityCaption(a)};return b}(c("ModalPhotoEditorTabBase"));g["default"]=a},98);
__d("ModalPhotoEditorRotateButton.react",["cx","fbt","Link.react","react"],function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||b("react");a=function(a){babelHelpers.inheritsLoose(c,a);function c(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.state={rotated:0},c.$2=function(){var a=c.state.rotated+1;a===4?c.setState(function(a,b){return{rotated:0}}):c.setState(function(b,c){return{rotated:a}});c.props.editor.rotate(!1)},b)||babelHelpers.assertThisInitialized(c)}var d=c.prototype;d.render=function(){return j.jsxs(b("Link.react"),{"aria-label":this.$1(),onClick:this.$2,"aria-live":"polite",className:"_mw0",children:[j.jsx("div",{className:"_mwc _45ij"}),h._("Girar")]})};d.$1=function(){var a=(90*this.state.rotated).toString();if(this.state.rotated%4===0)return h._("Girar");else return h._("Rotate button, rotated {degrees}degrees",[h._param("degrees",a)])};return c}(j.Component);e.exports=a},null);
__d("ModalPhotoEditorCropTab",["csx","cx","fbt","CropWindow","DOM","ModalPhotoEditorRotateButton.react","ModalPhotoEditorTabBase","ReactComponentRenderer","ReactDOM","XUIButton.react","XUIRadioButtonGroup.react","react"],function(a,b,c,d,e,f,g,h,i){var j,k=j||b("react"),l={FREEFORM:"freeform",SQUARE:"square"};a=function(a){"use strict";babelHelpers.inheritsLoose(c,a);function c(b){b=a.call(this,b)||this;b.$ModalPhotoEditorCropTab1=null;return b}var d=c.prototype;d.getName=function(){return"crop"};d.getLabel=function(){return i._("Recortar")};d.getIconClassName=function(){return"_45ii"};d.onActive=function(){this.editor.showUncroppedCanvas().setActiveGraphic(null),this.$ModalPhotoEditorCropTab1.show()};d.onLeave=function(){var a=this.$ModalPhotoEditorCropTab1.getCropDimensions();this.$ModalPhotoEditorCropTab1.hide();this.editor.setCropDimensions(a)};d.onImageLoaded=function(){var a=b("DOM").find(this.editor.root,"._1li5"),c=this.editor.getCropDimensions();this.$ModalPhotoEditorCropTab1=new(b("CropWindow"))(this.editor,a);this.$ModalPhotoEditorCropTab1.setInitialCropDimensions(c.x,c.y,c.width,c.height)};d.createPanelContents=function(){var a=null,c=b("DOM").create("div"),d=b("DOM").create("div");this.editor.isFeatureEnabled("square_crop_mode")&&(a=b("DOM").create("div"),this.$ModalPhotoEditorCropTab2=new(b("ReactComponentRenderer"))(b("XUIRadioButtonGroup.react"),a),this.$ModalPhotoEditorCropTab2.setProps({className:"_3-98",selectedValue:l.FREEFORM,selectedDepressed:!0,onValueChange:this.$ModalPhotoEditorCropTab3.bind(this),children:[k.jsx(b("XUIButton.react"),{className:"_kpl",value:l.FREEFORM,label:i._("Original")}),k.jsx(b("XUIButton.react"),{className:"_kpu",value:l.SQUARE,label:i._("Cuadrado")})]}));b("ReactDOM").render(k.jsx(b("ModalPhotoEditorRotateButton.react"),{editor:this.editor}),d);a&&c.appendChild(a);c.appendChild(d);return c};d.$ModalPhotoEditorCropTab3=function(a){if(!this.$ModalPhotoEditorCropTab1)return;a==l.SQUARE?this.$ModalPhotoEditorCropTab1.enableSquareCrop():this.$ModalPhotoEditorCropTab1.disableSquareCrop().reset();this.$ModalPhotoEditorCropTab2.setProps({selectedValue:a})};return c}(b("ModalPhotoEditorTabBase"));e.exports=a},null);
__d("ModalPhotoEditorFilterPreview.react",["cx","BackgroundImage.react","Link.react","prop-types","react"],function(a,b,c,d,e,f,g,h){var i=d("react");a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.state={isActive:c.props.isActive,loading:c.props.loading},c.$1=function(){if(c.state.isActive)return;c.setState({isActive:!0});c.props.onClick()},b)||babelHelpers.assertThisInitialized(c)}var d=b.prototype;d.render=function(){return i.jsxs(c("Link.react"),{className:"_1hka"+(this.state.isActive?" _1hx6":"")+(this.state.loading?" _1hwx":""),role:"menuitemradio",onClick:this.$1,"aria-label":this.props.label,"aria-checked":this.state.isActive,children:[i.jsx("div",{className:"_1hkb"}),i.jsx(c("BackgroundImage.react"),{width:this.props.width,height:this.props.height,src:this.props.image,backgroundSize:"cover",children:this.props.children})]})};return b}(i.Component);a.propTypes={image:c("prop-types").string,width:c("prop-types").number.isRequired,height:c("prop-types").number.isRequired,onClick:c("prop-types").func.isRequired,isActive:c("prop-types").bool.isRequired,loading:c("prop-types").bool,label:c("prop-types").string};g["default"]=a},98);
__d("ModalPhotoEditorFiltersTab",["cx","fbt","DOM","ModalPhotoEditorFilterPreview.react","ModalPhotoEditorTabBase","PhotoEditorCanvas","PhotoEditorFilters","ReactComponentRenderer","ReactDOM","react"],function(a,b,c,d,e,f,g,h){var i,j=i||b("react"),k=60,l=180,m=l/k;a=function(a){"use strict";babelHelpers.inheritsLoose(c,a);function c(b){b=a.call(this,b)||this;b.$ModalPhotoEditorFiltersTab1=null;return b}var d=c.prototype;d.getName=function(){return"filters"};d.getLabel=function(){return h._("Filtros")};d.getIconClassName=function(){return"_2sd7"};d.createPanelContents=function(){return b("DOM").create("div")};d.onImageLoaded=function(){var a=this;this.$ModalPhotoEditorFiltersTab2=this.$ModalPhotoEditorFiltersTab3();this.$ModalPhotoEditorFiltersTab4();b("PhotoEditorFilters").getFilters().forEach(function(b){a.$ModalPhotoEditorFiltersTab5(b)})};d.$ModalPhotoEditorFiltersTab3=function(){var a=this.editor.getOriginalImage(),c=a.width/a.height,d=new(b("PhotoEditorCanvas"))().setWidth(l).setHeight(k);c>m?d.drawGraphic(a,-(k*c-l)/2,0,k*c,k):d.drawGraphic(a,0,-(l/c-k)/2,l,l/c);return d};d.$ModalPhotoEditorFiltersTab4=function(){var a=this,c=b("DOM").create("div"),d=!this.editor.getFilter(),e=b("ReactDOM").render(j.jsx(b("ModalPhotoEditorFilterPreview.react"),{image:this.$ModalPhotoEditorFiltersTab2.toDataURL(),width:l,height:k,isActive:d,label:h._("Versi\u00f3n original"),onClick:function(){a.editor.removeFilter(),a.$ModalPhotoEditorFiltersTab6(e)},children:h._("Original")}),c);d&&(this.$ModalPhotoEditorFiltersTab1=e);this.getPanelContents().appendChild(c)};d.$ModalPhotoEditorFiltersTab5=function(a){var c=this,d=this.editor.getFilter()==a,e=new a(),f=b("DOM").create("div"),g=new(b("PhotoEditorCanvas"))().setImageContent(this.$ModalPhotoEditorFiltersTab2.getElement()),h=new(b("ReactComponentRenderer"))(b("ModalPhotoEditorFilterPreview.react"),f);h.setProps({image:this.$ModalPhotoEditorFiltersTab2.toDataURL(),width:l,height:k,isActive:d,loading:!0,label:e.getLabel(),onClick:function(){var b=c.$ModalPhotoEditorFiltersTab1;c.editor.showLoader();c.$ModalPhotoEditorFiltersTab6(h.component);c.editor.addFilter(a,function(){return c.editor.hideLoader()},function(){c.editor.hideLoader(),c.$ModalPhotoEditorFiltersTab6(b)})},children:[e.getName()]});this.getPanelContents().appendChild(f);d&&(this.$ModalPhotoEditorFiltersTab1=h.component);e.run(g,function(){h.setProps({image:g.toDataURL()}),h.component.setState({loading:!1})})};d.$ModalPhotoEditorFiltersTab6=function(a){if(a===this.$ModalPhotoEditorFiltersTab1)return;this.$ModalPhotoEditorFiltersTab1.setState({isActive:!1});this.$ModalPhotoEditorFiltersTab1=a};return c}(b("ModalPhotoEditorTabBase"));e.exports=a},null);
__d("ModalPhotoEditorProductTagTab",["cx","fbt","DOM","ModalPhotoEditorTabBase","ProductTaggingCreatorTypedLogger"],function(a,b,c,d,e,f,g,h,i){a=function(a){babelHelpers.inheritsLoose(b,a);function b(b){b=a.call(this,b)||this;b.$ModalPhotoEditorProductTagTab1=b.editor.getPhotoProductTagger();b.$ModalPhotoEditorProductTagTab2=b.$ModalPhotoEditorProductTagTab1.getViewer();b.getPanelContents().appendChild(b.$ModalPhotoEditorProductTagTab1.getSecondaryContent());return b}var d=b.prototype;d.getName=function(){return"product_tag"};d.getLabel=function(){return i._("Etiquetar productos")};d.getIconClassName=function(){return"_2zk5"};d.onActive=function(){new(c("ProductTaggingCreatorTypedLogger"))().setEvent("Imp_PhotoEditorProductTaggingTabEnter").setCreatorID(this.$ModalPhotoEditorProductTagTab1.photoData.owner).setMediaID(this.editor.photoFBID).log(),this.$ModalPhotoEditorProductTagTab1.updateFaceboxSuggestions(),this.$ModalPhotoEditorProductTagTab2.show()};d.onLeave=function(){this.$ModalPhotoEditorProductTagTab2.hide(),this.editor.setTagData(this.$ModalPhotoEditorProductTagTab1.getAllTagData())};d.onImageLoaded=function(){this.$ModalPhotoEditorProductTagTab2.registerEditor(this.editor).setDimensions(this.editor.getCanvasDimensions()).setPosition(this.editor.getCanvasPosition()),this.$ModalPhotoEditorProductTagTab1.setFaceboxPositionsFromData(this.editor.getFaceboxData()).loadPhotoTags(this.editor.getTagData()),this.editor.setFaceboxData(this.$ModalPhotoEditorProductTagTab1.getFaceboxData())};d.onTabButtonClicked=function(){new(c("ProductTaggingCreatorTypedLogger"))().setEvent("Actn_PhotoEditorProductTaggingTabClick").setCreatorID(this.$ModalPhotoEditorProductTagTab1.photoData.owner).setMediaID(this.editor.photoFBID).log()};d.createPanelContents=function(){var a=c("DOM").create("div"),b=c("DOM").create("div",{className:"_8t4b"},i._("Haz clic en un producto de la foto para etiquetarlo."));a.appendChild(b);b=c("DOM").create("div",{className:"_8t4b"},i._("Las personas podr\u00e1n comprar directamente desde tu publicaci\u00f3n."));a.appendChild(b);return a};return b}(c("ModalPhotoEditorTabBase"));g["default"]=a},98);
__d("ModalPhotoEditorStickersTab",["csx","cx","fbt","AsyncRequest","DOM","ModalPhotoEditorTabBase","PhotoEditorConfig","ReactDOM","SubscriptionsHandler","UFIStickerButton.react","react"],function(a,b,c,d,e,f,g,h,i){var j,k=b("PhotoEditorConfig").Constants,l=j||(j=b("react"));a=function(a){"use strict";babelHelpers.inheritsLoose(c,a);function c(c){c=a.call(this,c)||this;c.$ModalPhotoEditorStickersTab1=new(b("SubscriptionsHandler"))();c.$ModalPhotoEditorStickersTab2=b("DOM").find(c.getPanelContents(),".UFICommentStickerButton");return c}var d=c.prototype;d.getName=function(){return"stickers"};d.getLabel=function(){return i._("Stickers")};d.getIconClassName=function(){return"_fyb"};d.onActive=function(){this.$ModalPhotoEditorStickersTab2.click()};d.createPanelContents=function(){var a=b("DOM").create("div");b("ReactDOM").render(l.jsx(b("UFIStickerButton.react"),{showTooltip:!1,stickerInterface:"composer",onStickerSelected:this.$ModalPhotoEditorStickersTab3.bind(this),children:i._("A\u00f1adir sticker")}),a);return a};d.$ModalPhotoEditorStickersTab3=function(a){var c=this;new(b("AsyncRequest"))(k.ADD_STICKER_PATH).setData({id:a}).setHandler(function(b){var d=c.editor.addStickerGraphic(a,b.payload.sticker_src);c.$ModalPhotoEditorStickersTab1.addSubscriptions(d.subscribe("loaded",function(){c.editor.setActiveGraphic(d)}))}).send()};return c}(b("ModalPhotoEditorTabBase"));e.exports=a},null);
__d("ModalPhotoEditorTagTab",["cx","fbt","CurrentUser","DOM","ModalPhotoEditorTabBase"],function(a,b,c,d,e,f,g,h){a=function(a){"use strict";babelHelpers.inheritsLoose(c,a);function c(b){b=a.call(this,b)||this;b.$ModalPhotoEditorTagTab1=b.editor.getPhotoTagger();b.$ModalPhotoEditorTagTab2=b.$ModalPhotoEditorTagTab1.getViewer();b.getPanelContents().appendChild(b.$ModalPhotoEditorTagTab1.getSecondaryContent());return b}var d=c.prototype;d.getName=function(){return"tag"};d.getLabel=function(){return h._("Etiquetar")};d.getIconClassName=function(){return"_2sd8"};d.onActive=function(){this.$ModalPhotoEditorTagTab1.updateFaceboxSuggestions(),this.$ModalPhotoEditorTagTab2.show()};d.onLeave=function(){this.$ModalPhotoEditorTagTab2.hide(),this.editor.setTagData(this.$ModalPhotoEditorTagTab1.getAllTagData())};d.onImageLoaded=function(){this.$ModalPhotoEditorTagTab2.registerEditor(this.editor).setDimensions(this.editor.getCanvasDimensions()).setPosition(this.editor.getCanvasPosition()),this.$ModalPhotoEditorTagTab1.setFaceboxPositionsFromData(this.editor.getFaceboxData()).loadPhotoTags(this.editor.getTagData()),this.editor.setFaceboxData(this.$ModalPhotoEditorTagTab1.getFaceboxData())};d.createPanelContents=function(){var a=b("DOM").create("div"),c=b("DOM").create("div",{className:"_18nm"},h._({"friends":"Haz clic en cualquier sitio de la foto para etiquetar a amigos","coworkers":"Haz clic en cualquier sitio de la foto para etiquetar a compa\u00f1eros de trabajo"},[h._enum(b("CurrentUser").isWorkUser()?"coworkers":"friends",{friends:"friends",coworkers:"coworkers"})]));a.appendChild(c);return a};return c}(b("ModalPhotoEditorTabBase"));e.exports=a},null);
__d("ModalPhotoEditorColorPicker",["cx","CSS","DOM","PhotoEditorCanvas","PhotoEditorDragRegistrar","Style","SubscriptionsHandler","Vector","clamp","emptyFunction"],function(a,b,c,d,e,f,g){var h=new(b("Vector"))(180,50);a=function(a){"use strict";babelHelpers.inheritsLoose(c,a);function c(c){c===void 0&&(c=null);var d=b("DOM").create("div",{className:"_16i9"});d=a.call(this,d)||this;d.$ModalPhotoEditorColorPicker1=new(b("Vector"))(h.x,h.y);c&&(d.$ModalPhotoEditorColorPicker1.x=c);d.$ModalPhotoEditorColorPicker2=new(b("Vector"))(0,0,"document");d.$ModalPhotoEditorColorPicker3=b("emptyFunction");d.$ModalPhotoEditorColorPicker4();return d}var d=c.prototype;d.$ModalPhotoEditorColorPicker4=function(){this.$ModalPhotoEditorColorPicker5=new(b("PhotoEditorCanvas"))().setWidth(this.$ModalPhotoEditorColorPicker1.x).setHeight(this.$ModalPhotoEditorColorPicker1.y);var a=this.$ModalPhotoEditorColorPicker5.getContext(),c=a.createLinearGradient(0,0,this.$ModalPhotoEditorColorPicker1.x,0);c.addColorStop(.03,"grey");c.addColorStop(.21,"red");c.addColorStop(.35,"yellow");c.addColorStop(.52,"green");c.addColorStop(.67,"lightblue");c.addColorStop(.84,"blue");c.addColorStop(.97,"deeppink");this.$ModalPhotoEditorColorPicker5.fillRect(0,0,this.$ModalPhotoEditorColorPicker1.x,this.$ModalPhotoEditorColorPicker1.y,c);var d=.5;c=a.createLinearGradient(0,0,0,this.$ModalPhotoEditorColorPicker1.y*d);c.addColorStop(0,"rgba(255, 255, 255, 1)");c.addColorStop(.05,"rgba(255, 255, 255, 1)");c.addColorStop(.9,"rgba(255, 255, 255, 0)");this.$ModalPhotoEditorColorPicker5.fillRect(0,0,this.$ModalPhotoEditorColorPicker1.x,this.$ModalPhotoEditorColorPicker1.y,c);c=a.createLinearGradient(0,this.$ModalPhotoEditorColorPicker1.y*(1-d),0,this.$ModalPhotoEditorColorPicker1.y);c.addColorStop(.1,"rgba(0, 0, 0, 0)");c.addColorStop(.95,"rgba(0, 0, 0, 1)");c.addColorStop(1,"rgba(0, 0, 0, 1)");this.$ModalPhotoEditorColorPicker5.fillRect(0,this.$ModalPhotoEditorColorPicker1.y*d,this.$ModalPhotoEditorColorPicker1.x,this.$ModalPhotoEditorColorPicker1.y,c);a=this.$ModalPhotoEditorColorPicker5.getElement();b("CSS").addClass(a,"_16ia");this.$ModalPhotoEditorColorPicker6=b("DOM").create("div",{className:"_16ib",tabindex:"0"});this.$ModalPhotoEditorColorPicker7=new(b("SubscriptionsHandler"))();this.$ModalPhotoEditorColorPicker7.addSubscriptions(Event.listen(this.$ModalPhotoEditorColorPicker6,"keydown",this.onMouseDown.bind(this)));this.root.appendChild(a);this.root.appendChild(this.$ModalPhotoEditorColorPicker6);this.$ModalPhotoEditorColorPicker8()};d.$ModalPhotoEditorColorPicker8=function(){this.$ModalPhotoEditorColorPicker2.setElementPosition(this.$ModalPhotoEditorColorPicker6),b("Style").apply(this.$ModalPhotoEditorColorPicker6,{background:this.getColor(),borderColor:this.$ModalPhotoEditorColorPicker9()})};d.$ModalPhotoEditorColorPicker10=function(a){if(a.type==="keydown"){var c=a.key==="ArrowLeft"?-1:a.key==="ArrowRight"?1:0,d=a.key==="ArrowUp"?-1:a.key==="ArrowDown"?1:0;c=this.$ModalPhotoEditorColorPicker2.x+c;d=this.$ModalPhotoEditorColorPicker2.y+d;return new(b("Vector"))(b("clamp")(c,0,this.$ModalPhotoEditorColorPicker1.x-1),b("clamp")(d,0,this.$ModalPhotoEditorColorPicker1.y-1),"document")}c=b("Vector").getEventPosition(a,"document").sub(b("Vector").getElementPosition(this.$ModalPhotoEditorColorPicker5.getElement()));return new(b("Vector"))(b("clamp")(c.x,0,this.$ModalPhotoEditorColorPicker1.x-1),b("clamp")(c.y,0,this.$ModalPhotoEditorColorPicker1.y-1),"document")};d.$ModalPhotoEditorColorPicker11=function(a){return this.$ModalPhotoEditorColorPicker5.getPixelColor(a.x,a.y)};d.$ModalPhotoEditorColorPicker9=function(){var a=this.$ModalPhotoEditorColorPicker2;return this.$ModalPhotoEditorColorPicker5.getPixelColor(a.x,a.y,function(a){a.r=Math.round(a.r*.75);a.g=Math.round(a.g*.75);a.b=Math.round(a.b*.75);return a})};d.setColorChangeHandler=function(a){this.$ModalPhotoEditorColorPicker3=a;return this};d.setColorCoordinates=function(a){this.$ModalPhotoEditorColorPicker2=a;this.$ModalPhotoEditorColorPicker8();return this};d.getColorCoordinates=function(){return this.$ModalPhotoEditorColorPicker2};d.getColor=function(){return this.$ModalPhotoEditorColorPicker11(this.$ModalPhotoEditorColorPicker2)};d.onMouseDown=function(a){b("CSS").addClass(this.$ModalPhotoEditorColorPicker6,"_1hx6"),this.onMouseMove(a)};d.onMouseMove=function(a){a=this.$ModalPhotoEditorColorPicker10(a);var b=this.$ModalPhotoEditorColorPicker11(a);this.setColorCoordinates(a);this.$ModalPhotoEditorColorPicker3(b)};d.onMouseUp=function(){b("CSS").removeClass(this.$ModalPhotoEditorColorPicker6,"_1hx6");var a=this.$ModalPhotoEditorColorPicker11(this.$ModalPhotoEditorColorPicker2);this.$ModalPhotoEditorColorPicker3(a)};return c}(b("PhotoEditorDragRegistrar"));e.exports=a},null);
__d("findDOMNode",["ReactDOM"],function(a,b,c,d,e,f){"use strict";a=b("ReactDOM").findDOMNode;e.exports=a},null);
__d("ModalPhotoEditorFontSelector.react",["invariant","PhotoEditorConfig","Style","XUISelector.react","findDOMNode","prop-types","react"],function(a,b,c,d,e,f,g,h){var i=d("react");a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,d;for(var e=arguments.length,f=new Array(e),g=0;g<e;g++)f[g]=arguments[g];return(b=d=a.call.apply(a,[this].concat(f))||this,d.state={value:d.props.initialValue},d.$1=function(){var a=c("PhotoEditorConfig").Constants.FONTS,b=[],d;for(var e in a)d=a[e],d=i.jsx(c("XUISelector.react").Option,{value:d,children:i.jsx("span",{style:{fontFamily:d},children:e})},e),b.push(d);return b},d.$2=function(a){d.refs&&d.refs.selector||h(0,5500),c("Style").set(c("findDOMNode")(d.refs.selector),"fontFamily",a.value),d.props.onChange?d.props.onChange(a):d.setState({value:a.value})},b)||babelHelpers.assertThisInitialized(d)}var d=b.prototype;d.render=function(){return i.jsx(c("XUISelector.react"),babelHelpers["extends"]({},this.props,{value:this.state.value,onChange:this.$2,ref:"selector",children:this.$1()}))};return b}(i.Component);a.propTypes={initialValue:c("prop-types").string.isRequired,onChange:c("prop-types").func};g["default"]=a},98);
__d("ModalPhotoEditorTextAlignSelector.react",["cx","fbt","PhotoEditorConfig","XUIButton.react","XUIRadioButtonGroup.react","prop-types","react"],function(a,b,c,d,e,f,g,h,i){var j=d("react");a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.state={value:c.props.initialValue},c.$1=function(a){c.props.onChange?c.props.onChange(a):c.setState({value:a})},b)||babelHelpers.assertThisInitialized(c)}var d=b.prototype;d.render=function(){return j.jsxs(c("XUIRadioButtonGroup.react"),babelHelpers["extends"]({},this.props,{selectedValue:this.state.value,selectedDepressed:!0,onValueChange:this.$1,children:[j.jsx(c("XUIButton.react"),{className:"_kpu",value:c("PhotoEditorConfig").Constants.TEXT_ALIGN.LEFT,label:i._("Izquierda")}),j.jsx(c("XUIButton.react"),{className:"_kpl",value:c("PhotoEditorConfig").Constants.TEXT_ALIGN.CENTER,label:i._("Centrado")})]}))};return b}(j.Component);a.propTypes={initialValue:c("prop-types").oneOf([c("PhotoEditorConfig").Constants.TEXT_ALIGN.LEFT,c("PhotoEditorConfig").Constants.TEXT_ALIGN.CENTER]).isRequired,onChange:c("prop-types").func};g["default"]=a},98);
__d("ModalPhotoEditorTextTab",["cx","fbt","DOM","Link.react","ModalPhotoEditorColorPicker","ModalPhotoEditorFontSelector.react","ModalPhotoEditorTabBase","ModalPhotoEditorTextAlignSelector.react","PhotoEditorConfig","ReactDOM","SubscriptionsHandler","react"],function(a,b,c,d,e,f,g,h){var i,j=b("PhotoEditorConfig").Constants,k=i||(i=b("react"));a=function(a){"use strict";babelHelpers.inheritsLoose(c,a);function c(c){var d;d=a.call(this,c)||this;d.$ModalPhotoEditorTextTab1=new(b("SubscriptionsHandler"))();d.$ModalPhotoEditorTextTab2=j.DEFAULT_FONT_FAMILY;d.$ModalPhotoEditorTextTab3=j.DEFAULT_TEXT_ALIGN;d.$ModalPhotoEditorTextTab4=null;d.$ModalPhotoEditorTextTab1.addSubscriptions(c.subscribe("textAdded",d.$ModalPhotoEditorTextTab5.bind(babelHelpers.assertThisInitialized(d))));return d}var d=c.prototype;d.getName=function(){return"text"};d.getLabel=function(){return h._("Texto")};d.getIconClassName=function(){return"_32h0"};d.createPanelContents=function(){var a=b("DOM").create("div");b("ReactDOM").render(k.jsxs(b("Link.react"),{className:"_mw0",onClick:this.$ModalPhotoEditorTextTab6.bind(this),children:[k.jsx("div",{className:"_mwc _32h1"}),h._("A\u00f1adir texto")]}),a);a.appendChild(this.$ModalPhotoEditorTextTab7());a.appendChild(this.$ModalPhotoEditorTextTab8());a.appendChild(this.$ModalPhotoEditorTextTab9());return a};d.$ModalPhotoEditorTextTab6=function(){var a=this.editor.addTextGraphic("",this.$ModalPhotoEditorTextTab2,this.$ModalPhotoEditorTextTab10.getColor(),this.$ModalPhotoEditorTextTab10.getColorCoordinates(),this.$ModalPhotoEditorTextTab3);this.editor.setActiveGraphic(a)};d.$ModalPhotoEditorTextTab11=function(a){var b=a.getColorCoordinates();b&&this.$ModalPhotoEditorTextTab10.setColorCoordinates(b);this.$ModalPhotoEditorTextTab12(a.getFontFamily());this.$ModalPhotoEditorTextTab13(a.getTextAlign());this.$ModalPhotoEditorTextTab4=a};d.$ModalPhotoEditorTextTab5=function(a,b){var c=this;b.subscribe("focus",function(){c.editor.setActiveTab(c),c.$ModalPhotoEditorTextTab11(b)});b.subscribe("blur",function(){c.$ModalPhotoEditorTextTab4==b&&(c.$ModalPhotoEditorTextTab4=null)})};d.$ModalPhotoEditorTextTab7=function(){this.$ModalPhotoEditorTextTab10=new(b("ModalPhotoEditorColorPicker"))().setColorChangeHandler(this.$ModalPhotoEditorTextTab14.bind(this));return this.$ModalPhotoEditorTextTab10.getElement()};d.$ModalPhotoEditorTextTab9=function(){var a=this,c=b("DOM").create("div");this.$ModalPhotoEditorTextTab15=b("ReactDOM").render(k.jsx(b("ModalPhotoEditorFontSelector.react"),{onChange:function(b){return a.$ModalPhotoEditorTextTab12(b.value)},initialValue:j.DEFAULT_FONT_FAMILY}),c);return c};d.$ModalPhotoEditorTextTab8=function(){var a=b("DOM").create("div",{className:"_3-98"});this.$ModalPhotoEditorTextTab16=b("ReactDOM").render(k.jsx(b("ModalPhotoEditorTextAlignSelector.react"),{initialValue:j.TEXT_ALIGN.CENTER,onChange:this.$ModalPhotoEditorTextTab13.bind(this)}),a);return a};d.$ModalPhotoEditorTextTab14=function(a){this.$ModalPhotoEditorTextTab4&&(this.$ModalPhotoEditorTextTab4.setColorCoordinates(this.$ModalPhotoEditorTextTab10.getColorCoordinates()),this.$ModalPhotoEditorTextTab4.setFillStyle(a))};d.$ModalPhotoEditorTextTab12=function(a){this.$ModalPhotoEditorTextTab2=a,this.$ModalPhotoEditorTextTab15.setState({value:a}),this.$ModalPhotoEditorTextTab4&&this.$ModalPhotoEditorTextTab4.setFontFamily(a)};d.$ModalPhotoEditorTextTab13=function(a){this.$ModalPhotoEditorTextTab3=a,this.$ModalPhotoEditorTextTab16.setState({value:a}),this.$ModalPhotoEditorTextTab4&&this.$ModalPhotoEditorTextTab4.setTextAlign(a)};return c}(b("ModalPhotoEditorTabBase"));e.exports=a},null);
__d("ModalPhotoEditorZoomInput.react",["cx","Locale","RangeInput.react","prop-types","react"],function(a,b,c,d,e,f,g,h){var i=d("react");a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.$1=function(a){if(c.props.onChange){a=Math.exp(c.props.flip?-a[0]:a[0]);a=Math.round(a*100)/100;c.props.onChange(a)}},b)||babelHelpers.assertThisInitialized(c)}var d=b.prototype;d.render=function(){var a=Math.log(this.props.max),b=Math.log(this.props.min),d=Math.log(this.props.value);this.props.flip&&(b=-a,a=-b,d*=-1);return i.jsxs("div",{children:[i.jsx("div",{className:"_3dth"}),i.jsx("div",{className:"_3dtj"}),i.jsx(c("RangeInput.react"),babelHelpers["extends"]({className:"_1k98"},this.props,{onChange:this.$1,max:a,min:b,values:[d]}))]})};return b}(i.Component);a.propTypes={onChange:c("prop-types").func,value:c("prop-types").number,max:c("prop-types").number,min:c("prop-types").number,flip:c("prop-types").bool};a.defaultProps={value:1,min:.5,max:2,flip:d("Locale").isRTL()};g["default"]=a},98);
__d("PhotoTagStore",["ActorURI","AsyncRequest","ThisControllerNoLongerExists","isEmpty"],function(a,b,c,d,e,f){var g;a=function(){"use strict";function a(){this._tagList={},this._textTagList={},this._originalTagList={},this._dirtyPhotosByUid={},a.instance=this}var c=a.prototype;c.getPhotoTags=function(a){return this._tagList[a]||{}};c.photoHasTags=function(a){return!(g||(g=b("isEmpty")))(this.getPhotoTags(a))};c.clear=function(){this._tagList={},this._textTagList={},this._originalTagList={},this._dirtyPhotosByUid={}};c.addTag=function(a,b,c,d){a[b]=a[b]||{};var e=a[b][c]||[];e.push(d);a[b][c]=e};c.revert=function(a){var c=this._tagList,d=this._originalTagList;for(var e in c)(g||(g=b("isEmpty")))(d[e][a])?c[e][a]=[]:c[e][a]=d[e][a];this._dirtyPhotosByUid={}};c.hasNewTags=function(){return!(g||(g=b("isEmpty")))(this._tagList)||!(g||(g=b("isEmpty")))(this._textTagList)};c.userHasDirtyTags=function(a){return!(g||(g=b("isEmpty")))(this._dirtyPhotosByUid[a])};c.userDirtyTagsCount=function(a){return Object.keys(this._dirtyPhotosByUid[a]).length};c.handleTagFetch=function(a){for(var b in a)this.loadTagInfo(b,a[b])};c.saveAlbumTagsForUser=function(a,c,d,e){e===void 0&&(e=!1);var f={},h=[],i=this._dirtyPhotosByUid[a]||{};for(var j in i){i=this._tagList[j][a];if((g||(g=b("isEmpty")))(i)){h[h.length]=j;continue}i.forEach(function(a){f[j]={x:a.x,y:a.y}})}i={subject:a,action:"save",save_tags:f};h=b("ActorURI").create("/ajax/photos/album/tags.php",c);e&&(i={subject:a,save_tags:JSON.stringify(f)},h=b("ThisControllerNoLongerExists").__DEADURI__("m9fhmxosp"));new(b("AsyncRequest"))().setURI(h).setData(i).setHandler(function(a){d(a.payload)}).setAllowCrossPageTransition(!0).send();delete this._dirtyPhotosByUid[a]};c.getTagsFromList=function(a){var b=[];for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c))for(var d in a[c])Object.prototype.hasOwnProperty.call(a[c],d)&&a[c][d].forEach(function(a){return b.push(a)});return b};c.getAllTags=function(){var a=this.getTagsFromList(this._tagList),b=this.getTagsFromList(this._textTagList);return a.concat(b)};c.removeTag=function(a,c){var d=this._tagList[a],e=this._originalTagList[a]||{};e[c]?(this._dirtyPhotosByUid[c]=this._dirtyPhotosByUid[c]||{},this._dirtyPhotosByUid[c][a]=!0):delete this._dirtyPhotosByUid[c][a];for(var e in d)if(e==c){d=this._tagList[a][e];delete this._tagList[a][e];(g||(g=b("isEmpty")))(this._tagList[a])&&delete this._tagList[a];return d}};c.removeTextTag=function(a,c){var d=this._textTagList[a];if(!(g||(g=b("isEmpty")))(d[c])){d=this._textTagList[a][c];this._textTagList[a][c]=[];(g||(g=b("isEmpty")))(this._textTagList[a])&&delete this._textTagList[a];return d}return[]};c.removeAllNewTagsOfUser=function(a){var b=[];if(!this.userHasDirtyTags(a))return b;var c=this._dirtyPhotosByUid[a];for(var c in c)b=b.concat(this.removeTag(c,a));return b};c.removeAllTagsFromPhoto=function(a){var c=[];if(!(g||(g=b("isEmpty")))(this._tagList[a]))for(var d in this._tagList[a]){if(!Object.prototype.hasOwnProperty.call(this._tagList[a],d))continue;c=c.concat(this.removeTag(a,d))}if(!(g||(g=b("isEmpty")))(this._textTagList[a]))for(var d in this._textTagList[a]){if(!Object.prototype.hasOwnProperty.call(this._textTagList[a],d))continue;c=c.concat(this.removeTextTag(a,d))}return c};c.storeTag=function(a,b,c,d,e){this.storeTagWithOptions(a,b,c,d,{can_remove:e})};c.storeTagWithOptions=function(a,b,c,d,e){this._dirtyPhotosByUid[b]=this._dirtyPhotosByUid[b]||{};this._dirtyPhotosByUid[b][a]=!0;c={x:c,y:d};Object.assign(c,e);!b?this.addTag(this._textTagList,a,c.name,c):this.addTag(this._tagList,a,b,c)};c.loadTagInfo=function(a,b){this._tagList[a]={};this._originalTagList[a]={};for(var c=0;c<b.length;c++){var d=b[c];this.addTag(this._tagList,a,d.subject,d);this.addTag(this._originalTagList,a,d.subject,d)}};a.getInstance=function(){a.instance===null&&new a();return a.instance};return a}();a.instance=null;e.exports=a},null);
__d("ModalPhotoEditor",["csx","cx","invariant","ActorURI","Arbiter","AsyncRequest","Button","CSS","DOM","DialogX","Event","FunnelLogger","LayerDestroyOnHide","LayerHideOnEscape","ModalPhotoEditorCancelDialog.react","ModalPhotoEditorCaptionTab","ModalPhotoEditorCropTab","ModalPhotoEditorFiltersTab","ModalPhotoEditorNavButtons.react","ModalPhotoEditorProductTagTab","ModalPhotoEditorStickersTab","ModalPhotoEditorTabBase","ModalPhotoEditorTagTab","ModalPhotoEditorTextTab","ModalPhotoEditorZoomInput.react","PhotoEditor","PhotoEditorConfig","PhotoEditorGraphic","PhotoEditorSaveStates","PhotoEditorSessionLogging","PhotoTagStore","ProductTaggingCreatorTypedLogger","ReactComposerPhotoStore","ReactDOM","Style","SubscriptionsHandler","Vector","WebWorker","XStickerPhotoEditorController","areEqual","react"],function(a,b,c,d,e,f,g,h,i){var j,k,l=b("PhotoEditorConfig").Contexts,m=b("PhotoEditorConfig").Events,n=j||(j=b("react")),o=b("PhotoEditorGraphic").Sticker,p=b("PhotoEditorGraphic").Text,q=445,r=new(b("Vector"))(80,180),s=new(b("Vector"))(20,20),t=800,u=500,v=302,w=new(b("Vector"))(0,0,"document"),x=new Map(),y=null;a=function(a){"use strict";babelHelpers.inheritsLoose(c,a);function c(c){var d;d=a.call(this,c.spotlight.getRoot())||this;d.dialog=c.spotlight;d.feedbackID=c.feedbackID;d.gridID=c.gridID;d.latestFBID=c.latestFBID;d.photoFBID=c.photoFBID;d.encryptedPhotoID=c.encryptedPhotoID;d.targetType=c.targetType;d.userID=c.userID;d.$ModalPhotoEditor1=c.aspectRatio;d.$ModalPhotoEditor2=c.isFeatureEnabled;d.$ModalPhotoEditor3=null;d.$ModalPhotoEditor4=null;d.$ModalPhotoEditor5=w;d.$ModalPhotoEditor6=[];d.$ModalPhotoEditor7=x.get(d.photoFBID)||{};d.$ModalPhotoEditor8=d.$ModalPhotoEditor7.faceboxData||new Map();d.$ModalPhotoEditor9=null;d.$ModalPhotoEditor10=c.photoTagger;d.$ModalPhotoEditor11=c.photoProductTagger;d.$ModalPhotoEditor12=[];d.$ModalPhotoEditor13=1;x["delete"](d.photoFBID);var e=[];c.isFeatureEnabled.filter&&b("WebWorker").isSupported()&&e.push(b("ModalPhotoEditorFiltersTab"));var f=c.isFeatureEnabled.tag&&d.$ModalPhotoEditor10,g=c.isFeatureEnabled.product_tag&&d.$ModalPhotoEditor11;if(f||g){var h=b("PhotoTagStore").getInstance().getPhotoTags(d.latestFBID),i=b("ReactComposerPhotoStore").getXYTags(d.gridID,d.latestFBID),j=b("ReactComposerPhotoStore").getTaggedFaceboxes(d.gridID,d.latestFBID);for(var k in h)d.$ModalPhotoEditor6=d.$ModalPhotoEditor6.concat(h[k]);i&&i.forEach(function(a){return d.$ModalPhotoEditor6=d.$ModalPhotoEditor6.concat(a)});j&&j.forEach(function(a){return d.$ModalPhotoEditor6=d.$ModalPhotoEditor6.concat({facebox:a.id,subject:a.taggedSubjectID,name:a.taggedValue,from_facebox:!0})});f&&e.push(b("ModalPhotoEditorTagTab"));g&&(d.$ModalPhotoEditor14(),e.push(b("ModalPhotoEditorProductTagTab")))}c.isFeatureEnabled.crop&&d.targetType!=="profile_pic"&&e.push(b("ModalPhotoEditorCropTab"));c.isFeatureEnabled.text&&e.push(b("ModalPhotoEditorTextTab"));c.isFeatureEnabled.caption&&(e.push(b("ModalPhotoEditorCaptionTab")),d.addAutomaticAltText(c.automaticAltText));c.isFeatureEnabled.stickers&&e.push(b("ModalPhotoEditorStickersTab"));d.$ModalPhotoEditor15(e,c.initialTab);c.isFeatureEnabled.zoom&&d.$ModalPhotoEditor16();c.isFeatureEnabled.nav&&d.$ModalPhotoEditor17();y&&y.destroyEditor(!0);y=babelHelpers.assertThisInitialized(d);d.setTagData(d.$ModalPhotoEditor7.tags?d.$ModalPhotoEditor7.tags:d.$ModalPhotoEditor6);d.hideLoader();d.loadPhoto(c.photoURI);d.enable();d.targetType==="composer"&&b("Arbiter").inform("AttachmentsPhotoEditor/logPhotoEditorLaunched"+d.gridID);return d}var d=c.prototype;d.initDOM=function(){var a;this.canvasWrapperEl=(a=b("DOM")).find(this.root,"._510w");this.$ModalPhotoEditor18=a.find(this.root,"._4hsm");this.$ModalPhotoEditor19=a.find(this.root,"._4hsn");this.$ModalPhotoEditor20=a.find(this.root,"._5n01");this.$ModalPhotoEditor21=a.find(this.root,"._2ret");this.stage=a.find(this.root,"._1hxa");this.$ModalPhotoEditor22=a.find(this.root,"._1hx2");this.$ModalPhotoEditor23=a.find(this.root,"._510x");this.$ModalPhotoEditor24=a.find(this.root,"._1hx1");this.$ModalPhotoEditor25=a.find(this.root,"._1hwy");this.$ModalPhotoEditor26=a.find(this.root,"._1hx7")};d.$ModalPhotoEditor16=function(){var a=b("DOM").find(this.root,"._37vc");b("ReactDOM").render(n.jsx(b("ModalPhotoEditorZoomInput.react"),{min:.5,max:2,value:this.$ModalPhotoEditor13,onChange:this.zoom.bind(this)}),a)};d.$ModalPhotoEditor17=function(){var a=b("DOM").find(this.root,"._451s"),c=b("ReactComposerPhotoStore").getPhotos(this.gridID);if(c.length<2)return;var d=c.get(this.photoFBID).uploadIndex;b("ReactDOM").render(n.jsx(b("ModalPhotoEditorNavButtons.react"),{currentIndex:d,total:c.length,onNext:this.nextImage.bind(this),onPrev:this.prevImage.bind(this)}),a)};d.$ModalPhotoEditor15=function(a,c){var d=this,e=null;a.forEach(function(a){a=new a(d);a instanceof b("ModalPhotoEditorTabBase")||i(0,2208,a.constructor.name);(c==a.getName()||!e)&&(e=a);d.$ModalPhotoEditor12.push(a);b("CSS").hide(a.getPanelContents());d.$ModalPhotoEditor25.appendChild(a.getTabButton());d.$ModalPhotoEditor24.appendChild(a.getPanelContents())});e&&this.setActiveTab(e)};d.hideLoader=function(){b("Button").setEnabled(this.$ModalPhotoEditor23,!0);b("CSS").hide(this.$ModalPhotoEditor21);return this};d.showLoader=function(){b("Button").setEnabled(this.$ModalPhotoEditor23,!1);b("CSS").show(this.$ModalPhotoEditor21);return this};d.setActiveTab=function(a){if(a===this.$ModalPhotoEditor3)return;this.$ModalPhotoEditor3&&(b("CSS").removeClass(this.$ModalPhotoEditor3.getTabButton(),"_1hx6"),b("DOM").setAttributes(this.$ModalPhotoEditor3.getTabButton().firstChild,{"aria-selected":!1}),b("CSS").hide(this.$ModalPhotoEditor3.getPanelContents()),this.$ModalPhotoEditor3.onLeave());b("CSS").addClass(a.getTabButton(),"_1hx6");b("DOM").setAttributes(a.getTabButton().firstChild,{"aria-selected":!0});b("CSS").show(a.getPanelContents());this.$ModalPhotoEditor3=a;this.$ModalPhotoEditor27();this.isEnabled&&a.onActive();a.getName()==="custom_accessibility_caption"&&b("FunnelLogger").appendAction("WWW_ALT_TEXT_COMPOSER_FUNNEL","[Photo Editor] open caption tab")};d.$ModalPhotoEditor27=function(){if(!this.$ModalPhotoEditor3)return;var a=this.$ModalPhotoEditor3.getTabButton();a=b("Vector").getElementPosition(a).y-b("Vector").getElementPosition(this.$ModalPhotoEditor25).y+b("Vector").getElementDimensions(a).y/2-b("Vector").getElementDimensions(this.$ModalPhotoEditor26).y/2;b("Style").set(this.$ModalPhotoEditor26,"top",a+"px")};d.$ModalPhotoEditor28=function(a){b("CSS").conditionClass(this.root,"_1hwx",a),b("Button").setEnabled(this.$ModalPhotoEditor23,!a)};d.onImageLoaded=function(c){var d=this;this.$ModalPhotoEditor28(!1);this.$ModalPhotoEditor29={x:0,y:0,width:c.width,height:c.height};a.prototype.onImageLoaded.call(this,c);c=b("PhotoEditorSaveStates").getState(this.photoFBID);this.$ModalPhotoEditor30=c||this.serialize();c=this.$ModalPhotoEditor7.state?this.$ModalPhotoEditor7.state:c;if(c){c.filter&&(this.showLoader(),this.filter=c.filter,this.addFilter(c.filter,this.hideLoader.bind(this)));c.customAccessibilityCaption&&this.addCustomAccessibilityCaption(c.customAccessibilityCaption);this.setCropDimensions(c.cropDimensions);for(var e=0;e<c.numRotations;e++)this.rotate(!0);c.graphics.forEach(function(a){var b=null;switch(a.type){case p:b=d.addTextGraphic();break;default:b=d.addStickerGraphic(a.sticker_id,a.imageURL)}b.initFromSerializedState(a)})}this.resize();this.$ModalPhotoEditor12.forEach(function(a){return a.onImageLoaded()});this.$ModalPhotoEditor3&&this.isEnabled&&this.$ModalPhotoEditor3.onActive()};d.getPhotoTagger=function(){return this.$ModalPhotoEditor10};d.getPhotoProductTagger=function(){return this.$ModalPhotoEditor11};d.getAspectRatio=function(){return this.$ModalPhotoEditor1};d.isFeatureEnabled=function(a){return!!this.$ModalPhotoEditor2[a]};d.showUncroppedCanvas=function(){this.crop(0,0,this.originalImage.width,this.originalImage.height);return this};d.setActiveGraphic=function(b){if(this.activeGraphic===b)return;this.activeGraphic&&!this.activeGraphic.isRemoved()&&this.getGraphicsLayer().appendChild(this.activeGraphic.getElement());if(b){var c=this.layers.indexOf(b);this.layers.splice(c,1);this.layers.push(b);this.$ModalPhotoEditor19.appendChild(b.getElement())}a.prototype.setActiveGraphic.call(this,b)};d.setCropDimensions=function(a){this.$ModalPhotoEditor29=a;this.crop(a.x,a.y,a.width,a.height);this.inform("crop",a);return this};d.getCropDimensions=function(){return this.$ModalPhotoEditor29};d.getGraphicsLayer=function(){return this.$ModalPhotoEditor18};d.getCanvasPosition=function(){return this.$ModalPhotoEditor5};d.enable=function(){if(this.isEnabled)return;this.dialog.show();this.$ModalPhotoEditor31();this.$ModalPhotoEditor32=new(b("SubscriptionsHandler"))();this.$ModalPhotoEditor32.addSubscriptions(b("Event").listen(window,"resize",this.resize.bind(this)),b("Event").listen(this.root,"mousedown",this.$ModalPhotoEditor33.bind(this)),this.dialog.subscribe("beforehide",this.$ModalPhotoEditor34.bind(this)),this.dialog.subscribe("hide",this.disable.bind(this)),b("Event").listen(this.$ModalPhotoEditor23,"click",this.$ModalPhotoEditor35.bind(this)));this.isEnabled=!0;this.sessionLogging=new(b("PhotoEditorSessionLogging"))(l.COMPOSER,!0).start()};d.addTextGraphic=function(){var b=a.prototype.addTextGraphic.apply(this,arguments);this.inform("textAdded",b);return b};d.$ModalPhotoEditor33=function(a){if(!this.activeGraphic||this.$ModalPhotoEditor36(a))return;this.setActiveGraphic(null)};d.$ModalPhotoEditor34=function(){if(!this.isEnabled)return!0;this.$ModalPhotoEditor3&&(this.$ModalPhotoEditor3.onLeave(),this.$ModalPhotoEditor3.getName()!=="product_tag"&&this.$ModalPhotoEditor3.onActive());if(x.size||this.$ModalPhotoEditor37()||this.$ModalPhotoEditor38()){this.$ModalPhotoEditor4=new(b("DialogX"))({addedBehaviors:[b("LayerDestroyOnHide"),b("LayerHideOnEscape")],width:q,xui:!0},n.jsx(b("ModalPhotoEditorCancelDialog.react"),{onConfirm:this.destroyEditor.bind(this,!0)})).show();return!1}return!0};d.$ModalPhotoEditor36=function(a){a=a.target;while(a&&a!==this.root){if(a===this.activeGraphic||a===this.$ModalPhotoEditor24)return!0;a=a.parentNode}return!1};d.rotate=function(b){a.prototype.rotate.call(this,b),this.inform("rotate",b),this.resize(),this.$ModalPhotoEditor39(m.ROTATE_IMAGE)};d.disable=function(){if(!this.isEnabled)return;this.$ModalPhotoEditor9&&this.$ModalPhotoEditor9.abandon();this.$ModalPhotoEditor4&&this.$ModalPhotoEditor4.hide();this.isEnabled=!1;this.sessionLogging.end(!0);y=null;this.$ModalPhotoEditor32.release()};d.$ModalPhotoEditor40=function(a){if(!this.$ModalPhotoEditor2.caption)return;this.customAccessibilityCaption?a?b("FunnelLogger").appendAction("WWW_ALT_TEXT_COMPOSER_FUNNEL","[Photo Editor] cancelled with alt text"):b("FunnelLogger").appendAction("WWW_ALT_TEXT_COMPOSER_FUNNEL","[Photo Editor] saved with alt text"):b("FunnelLogger").appendAction("WWW_ALT_TEXT_COMPOSER_FUNNEL","[Photo Editor] no alt text provided");b("FunnelLogger").endFunnel("WWW_ALT_TEXT_COMPOSER_FUNNEL")};d.destroyEditor=function(a){a&&(x=new Map()),this.$ModalPhotoEditor40(a),this.disable(),this.dialog.hide()};d.logAddGraphic=function(a){this.$ModalPhotoEditor39(m.ADD_STICKER)};d.logRemoveGraphic=function(a){this.$ModalPhotoEditor39(m.REMOVE_STICKER)};d.setTagData=function(a){this.$ModalPhotoEditor41=a;return this};d.getTagData=function(){return this.$ModalPhotoEditor41};d.setFaceboxData=function(a){this.$ModalPhotoEditor8=a;return this};d.getFaceboxData=function(){return this.$ModalPhotoEditor8};d.isFirstEdit=function(){return!b("PhotoEditorSaveStates").getState(this.photoFBID)};d.$ModalPhotoEditor39=function(a){this.sessionLogging.logEvent(a)};d.$ModalPhotoEditor37=function(){var a=this.serialize();return!(k||(k=b("areEqual")))(this.$ModalPhotoEditor30,a)};d.$ModalPhotoEditor38=function(){var a=this.getTagData();return!(k||(k=b("areEqual")))(this.$ModalPhotoEditor6,a)};d.hasCrop=function(){return!(this.workingCanvas.getWidth()==this.originalImage.width&&this.workingCanvas.getHeight()==this.originalImage.height)};d.$ModalPhotoEditor42=function(a){var c=this,d=this.serialize(),e={latestFBID:this.latestFBID,tags:this.getTagData(),faceboxData:this.getFaceboxData()};if(this.$ModalPhotoEditor37()){e.state=d;if(!(k||(k=b("areEqual")))(d,this.$ModalPhotoEditor7.state)){this.toBlob(function(b){e.blob=b,e.loggingData=c.$ModalPhotoEditor43(),x.set(c.photoFBID,e),a()});return}else e.blob=this.$ModalPhotoEditor7.blob,e.loggingData=this.$ModalPhotoEditor7.loggingData,x.set(this.photoFBID,e)}else this.$ModalPhotoEditor38()&&x.set(this.photoFBID,e);a()};d.nextImage=function(){var a=b("ReactComposerPhotoStore").getPhotos(this.gridID),c=a.get(this.photoFBID).uploadIndex;if(c==a.length-1)return;a=Array.from(a.values()).find(function(a){return a.uploadIndex===c+1});this.$ModalPhotoEditor44(a.id,a.id)};d.prevImage=function(){var a=b("ReactComposerPhotoStore").getPhotos(this.gridID),c=a.get(this.photoFBID).uploadIndex;if(c===0)return;a=Array.from(a.values()).find(function(a){return a.uploadIndex===c-1});this.$ModalPhotoEditor44(a.id,a.id)};d.$ModalPhotoEditor44=function(a,c){var d=this;if(!this.isEnabled||this.$ModalPhotoEditor9)return;a=b("XStickerPhotoEditorController").getURIBuilder().setString("grid_id",this.gridID).setEnum("target_type",this.targetType).setInt("photo_fbid",a).setInt("latest_fbid",c);this.$ModalPhotoEditor3&&a.setEnum("initial_tab",this.$ModalPhotoEditor3.getName());var e=b("ActorURI").create(a.getURI(),this.userID);this.$ModalPhotoEditor3&&this.$ModalPhotoEditor3.onLeave();this.$ModalPhotoEditor42(function(){d.$ModalPhotoEditor28(!0),d.$ModalPhotoEditor9=new(b("AsyncRequest"))(e).setHandler(d.destroyEditor.bind(d,!1)).setErrorHandler(function(){x["delete"](d.photoFBID),d.$ModalPhotoEditor28(!1),d.$ModalPhotoEditor3.onActive()}).setFinallyHandler(function(){d.$ModalPhotoEditor9=null}),d.$ModalPhotoEditor9.send()})};d.$ModalPhotoEditor43=function(){var a=this.serialize(),b={},c=[];a.graphics.forEach(function(a){if(a.type==o){var d=a.sticker_id;!(d in b)?b[d]=1:b[d]++}else a.type==p&&c.push(a.text)});return{stickers:b,textOverlays:c,hasCrop:this.hasCrop(),hasFilter:!!this.getFilter(),customAccessibilityCaption:this.getCustomAccessibilityCaption()}};d.$ModalPhotoEditor35=function(){var a=this,c;this.$ModalPhotoEditor3&&this.$ModalPhotoEditor3.onLeave();this.$ModalPhotoEditor42(function(){x.forEach(function(d,e){if(d.state){(a.targetType==="composer"||a.targetType==="profile_pic")&&(b("PhotoEditorSaveStates").setState(e,d.state),b("PhotoEditorSaveStates").setLoggingData(e,d.loggingData));c=babelHelpers["extends"]({},d.loggingData,{blob:d.blob,fbid:e,xyTags:d.tags,encryptedID:a.encryptedPhotoID});switch(a.targetType){case"composer":b("Arbiter").inform("AttachmentsPhotoEditor/newImage"+a.gridID,c);b("Arbiter").inform("AttachmentsPhotoEditor/imageEdited"+e);break;case"page_product_composer":b("Arbiter").inform("PageProductPhotoEditor/newImage"+a.gridID,c);break;case"comment":c.kind="blob";b("Arbiter").inform("newRemixedImage"+a.feedbackID,c);break;case"profile_pic":b("Arbiter").inform("ProfilePicPhotoEditor/newImage"+a.photoFBID,c);break}}else b("Arbiter").inform("AttachmentsPhotoEditor/tagsUpdated"+a.gridID,{fbid:d.latestFBID,xyTags:d.tags}),d.tags.length>0&&a.$ModalPhotoEditor45(d.tags)}),x=new Map(),a.sessionLogging.logPhotoSaved(),a.destroyEditor()})};d.zoom=function(a){if(this.$ModalPhotoEditor13==a)return;this.$ModalPhotoEditor13=a;this.resize()};d.getZoom=function(){return this.$ModalPhotoEditor13};d.$ModalPhotoEditor31=function(){var a=b("Vector").getViewportDimensions(),c=Math.max(a.y-r.y,u);a=Math.max(a.x-r.x,t);b("Style").set(this.$ModalPhotoEditor22,"height",c+"px");this.dialog.setWidth(a);this.dialog.updatePosition();this.inform("dialogResize",{height:c,width:a},"state");return new(b("Vector"))(a,c)};d.resize=function(){var a=this.$ModalPhotoEditor31(),c=this.getResizeFactor(),d=this.getImageDimensions();a=new(b("Vector"))(a.x-v,a.y,"document");var e=a.sub(s),f=this.$ModalPhotoEditor46();if(d.x>=e.x||d.y>=e.y){var g=d.x/d.y,h=e.x/e.y;h<g?d=new(b("Vector"))(e.x,Math.round(e.x/g)):h>g?d=new(b("Vector"))(Math.round(e.y*g),e.y):d=e}d=d.mul(this.$ModalPhotoEditor13);this.$ModalPhotoEditor5=new(b("Vector"))(Math.max(a.x-d.x,s.x),Math.max(a.y-d.y,s.y),"document").div(2);h={pos:this.$ModalPhotoEditor5,dims:d};d.setElementDimensions(this.$ModalPhotoEditor19);this.$ModalPhotoEditor5.setElementPosition(this.$ModalPhotoEditor19);g=this.$ModalPhotoEditor5;if(this.isInverted){e=g.add(d.div(2));d=new(b("Vector"))(d.y,d.x);g=e.sub(d.div(2))}d.setElementDimensions(this.canvasWrapperEl);g.setElementPosition(this.canvasWrapperEl);this.$ModalPhotoEditor47(f);this.$ModalPhotoEditor48(c);this.$ModalPhotoEditor27();this.inform("resize",h)};d.$ModalPhotoEditor46=function(){w.setElementDimensions(this.$ModalPhotoEditor20);var a=new(b("Vector"))(this.stage.scrollWidth,this.stage.scrollHeight,"document");a.setElementDimensions(this.$ModalPhotoEditor20);return a};d.$ModalPhotoEditor47=function(a){a=this.$ModalPhotoEditor46().sub(a).div(2);this.stage.scrollLeft+=a.x;this.stage.scrollTop+=a.y};d.$ModalPhotoEditor48=function(a){var b=this.getResizeFactor()/a;this.layers.forEach(function(a){a.onBeforeSuddenTransformation(),a.setPos(a.getPos().mul(b)),a.setDimensions(a.getDimensions().mul(b)),a.updatePos(),a.onAfterSuddenTransformation()})};d.$ModalPhotoEditor14=function(){new(b("ProductTaggingCreatorTypedLogger"))().setEvent("Imp_PhotoEditorProductTaggingTab").setCreatorID(this.userID).setMediaID(this.photoFBID).log()};d.$ModalPhotoEditor45=function(a){a=this.userID;new(b("ProductTaggingCreatorTypedLogger"))().setEvent("Actn_PhotoEditorSavetags").setCreatorID(a).log()};return c}(b("PhotoEditor"));e.exports=a},null);