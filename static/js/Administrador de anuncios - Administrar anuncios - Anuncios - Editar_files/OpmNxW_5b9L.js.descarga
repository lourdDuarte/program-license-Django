if (self.CavalryLogger) { CavalryLogger.start_js_script(document.currentScript); }/*FB_PKG_DELIM*/

__d("NotificationCounter",["Arbiter","CrossWindowEventEmitter","DocumentTitle","MessengerEnvironment"],function(a,b,c,d,e,f,g){var h=new(c("CrossWindowEventEmitter"))("JewelBase"),i={messages:0,notifications:0,requests:0};function a(){c("Arbiter").subscribe("update_title",m),c("Arbiter").subscribe("jewel/count-updated",l),h.addListener("count-updated",function(a){l("",a)})}function j(){var a=0;for(var b in i){var c=Number(i[b]);if(typeof i[b]==="string"&&isNaN(c))return i[b];if(isNaN(c)||c<0)continue;a+=c}return a}function k(){if(c("MessengerEnvironment").messengerui)return;var a=j();c("DocumentTitle").badge(a)}function l(a,b){i[b.jewel]=b.count,k()}function m(a,b){k()}g.init=a;g.getCount=j;g.updateTitle=k;g._handleCountUpdate=l;g._handleUpdate=m},98);
__d("NotificationJewelController",["AdsApplicationUtils","Arbiter","Bootloader","Event","FunnelLogger","IndeterminateNotificationCounter","NotificationConstants","NotificationCounter","NotificationJewelFunnelLoggingConstants","NotificationSeenState","NotificationStore","NotificationUpdates","clearTimeout","createObjectFrom","curry","gkx","ifRequired","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g){var h=0,i=!1;function j(a){var b=c("NotificationSeenState").getUnseenCount();c("Arbiter").inform("jewel/count-updated",{jewel:a,count:b,animation:"none"},"state")}a=function(){function a(a,b){var e=this,f=b.badgeAnimationData,g=b.classification,i=b.endPoint,k=b.isBizsite,l=b.list;b=b.unseenNotifs;i&&d("NotificationStore").registerEndpoint({endpointControllerName:i,classification:g});k?d("IndeterminateNotificationCounter").init(b.length):d("NotificationCounter").init();var m=c("Event").listen(a.getRoot(),"mouseover",function(){d("FunnelLogger").startFunnel(d("NotificationJewelFunnelLoggingConstants").FUNNEL_LOGGING_NAME),m&&m.remove(),m=null,d("FunnelLogger").appendAction(d("NotificationJewelFunnelLoggingConstants").FUNNEL_LOGGING_NAME,d("NotificationJewelFunnelLoggingConstants").FUNNEL_LOGGING_EVENT.MOUSE_OVER_ON_JEWEL),e.eagerRender(l)}),n=null;c("Event").listen(a.getRoot(),"mouseover",function(){n=c("setTimeoutAcrossTransitions")(function(){c("Bootloader").loadModules(["QE2Logger"],function(a){a.logExposureForUser("www_jewel_tooltip_experiment")},"NotificationJewelController"),n=null},500)});c("Event").listen(a.getRoot(),"mouseout",function(){n&&c("clearTimeout")(n)});var o=a.subscribe("opened",function(){o&&o.unsubscribe(),o=null,l.open()}),p=l.pause.bind(l);a.subscribe("opened",function(){window.setTimeout(p,0),j(a.name),c("Bootloader").loadModules(["NotificationVPVs"],function(a){return a.clearImpressions()},"NotificationJewelController"),c("Arbiter").inform("notificationJewel/opened")});a.subscribe("closed",function(){l.unpause(),j(a.name),c("Arbiter").inform("notificationJewel/closed"),l.setFlyoutOpenState(!1)});a.subscribe("user-open",function(a,b){d("AdsApplicationUtils").isPowerEditor()&&c("ifRequired")("AdsMgmtPerfScenarioController",function(a){var b=a.startScenario({name:"am:global_nav_bar:notification_init_load"},"outside_flux",null);c("gkx")("3638")&&c("ifRequired")("AdsInteractionIdController",function(a){a.attachScenarioIDToInteraction("am.global_nav_bar.notification_init_load",b)})}),l.setFlyoutOpenState(!0)});a.isOpen()&&l.setFlyoutOpenState(!0);d("NotificationUpdates").subscribe("seen-state-updated",c("curry")(j,a.name));f&&(f.logWithQEUniverse&&c("Bootloader").loadModules(["QE2Logger"],function(a){return a.logExposureForUser(f.logWithQEUniverse)},"NotificationJewelController"),f.injectWithAnimation&&c("Bootloader").loadModules(["RelationshipDelightsBadge"],function(b){return b.inject(a,f.injectWithAnimation)},"NotificationJewelController"));d("NotificationUpdates").handleUpdate(d("NotificationConstants").PayloadSourceType.INITIAL_LOAD,{seenState:c("createObjectFrom")(b,h)});j(a.name);c("Arbiter").inform("jewel_mounted")}var b=a.prototype;b.eagerRender=function(a){i||(i=!0,a.open())};return a}();g["default"]=a},98);